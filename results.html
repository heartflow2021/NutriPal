<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>營養好朋友 - 保健品資訊</title>
    <link rel="stylesheet" href="styles.css">
    <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
    <!-- 頂部導航 -->
    <div class="nav-header">
        <a href="chat.html" style="color: var(--text-primary); margin-right: 12px;">
            <i class="fas fa-arrow-left"></i>
        </a>
        <div style="flex: 1; text-align: center; font-weight: 600;">保健品推薦</div>
        <a href="#" onclick="shareResults()" style="margin-left: 12px; color: var(--text-primary);">
            <i class="fas fa-share-alt"></i>
        </a>
    </div>

    <!-- 主要內容區 -->
    <div class="app-content" style="padding: 16px;">
        <!-- 結果摘要 -->
        <div class="card" style="margin-bottom: 24px;">
            <div style="display: flex; align-items: center; margin-bottom: 12px;">
                <div class="avatar" style="background-color: var(--primary);">
                    <i class="fas fa-archive"></i>
                </div>
                <div>
                    <p style="margin: 0 0 2px; font-weight: 600;">小帕 Pal 的資料整理</p>
                    <p style="margin: 0; font-size: 12px; color: var(--text-secondary);">根據熱門選擇整理</p>
                </div>
            </div>
            <p class="selection-summary" style="margin: 0 0 12px;">根據你選擇的「<span class="health-need-display" style="color: var(--primary); font-weight: 600;">改善睡眠品質</span>」需求，以及「<span class="lifestyle-display" style="color: var(--primary); font-weight: 600;">長時間工作</span>」的生活型態，以下是我整理的熱門保健品資訊。</p>
            <div style="display: flex; flex-wrap: wrap; gap: 8px;">
                <span class="badge">相關熱門選擇</span>
                <span class="badge result-category">睡眠相關</span>
                <span class="badge">壓力緩解</span>
            </div>
        </div>

        <!-- 推薦產品列表 -->
        <h2 style="font-size: 18px; margin-bottom: 16px;">基礎熱門組合</h2>
        
        <!-- 產品容器 -->
        <div class="product-list" id="recommended-products">
            <!-- 產品將由JavaScript動態生成 -->
            <div class="loading-spinner" style="margin: 20px auto;"></div>
        </div>

        <!-- 進階推薦 -->
        <h2 style="font-size: 18px; margin: 24px 0 16px;">延伸相關選擇</h2>
        
        <!-- 相關產品容器 -->
        <div class="product-list" id="related-products">
            <!-- 相關產品將由JavaScript動態生成 -->
        </div>

        <!-- 每日服用時間表 -->
        <div class="card" style="margin-top: 24px;">
            <h2 style="font-size: 18px; margin: 0 0 16px;">常見使用時間參考</h2>
            
            <div class="timeline" id="usage-timeline">
                <!-- 時間表將由JavaScript動態生成 -->
            </div>
        </div>

        <!-- 注意事項 -->
        <div class="card" style="margin-top: 16px;" id="product-cautions">
            <h3 style="font-size: 16px; margin: 0 0 12px;">常見注意事項參考</h3>
            <ul class="cautions-list" style="margin: 0; padding-left: 20px; font-size: 14px; color: var(--text-secondary);">
                <!-- 注意事項將由JavaScript動態生成 -->
            </ul>
            <p style="font-size: 12px; color: var(--text-secondary); margin-top: 12px; text-align: center;">小帕不提供任何醫療建議，所有資訊僅供參考，請諮詢專業醫師進行健康決策～</p>
        </div>

        <!-- 操作按鈕 -->
        <div style="display: flex; gap: 12px; margin-top: 24px; margin-bottom: 100px;">
            <button class="btn-secondary" style="flex: 1;">
                <i class="fas fa-download"></i> 下載資訊
            </button>
            <button class="btn-primary" style="flex: 1;">
                <i class="fas fa-envelope"></i> 發送至 Email
            </button>
        </div>
    </div>

    <!-- 底部導航欄 -->
    <div class="tab-bar">
        <a href="home.html" class="tab-item">
            <i class="fas fa-home"></i>
            <span>首頁</span>
        </a>
        <a href="chat.html" class="tab-item">
            <i class="fas fa-comment-medical"></i>
            <span>諮詢</span>
        </a>
        <a href="knowledge.html" class="tab-item">
            <i class="fas fa-book-medical"></i>
            <span>知識庫</span>
        </a>
        <a href="#" class="tab-item">
            <i class="fas fa-user"></i>
            <span>我的</span>
        </a>
    </div>

    <!-- 引入腳本 -->
    <script src="js/recommendationEngine.js"></script>
    <!-- 不載入 main.js 以避免語法錯誤問題 -->
    <!-- <script src="js/main.js"></script> -->

    <!-- 添加備用顯示代碼 -->
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            console.log('results.html 頁面加載完成');
            
            // 檢查URL參數
            const urlParams = new URLSearchParams(window.location.search);
            const healthParam = urlParams.get('health');
            const lifestyleParam = urlParams.get('lifestyle');
            const budgetParam = urlParams.get('budget');
            
            console.log('URL參數檢查:', { healthParam, lifestyleParam, budgetParam });
            
            // 首先嘗試從 localStorage 讀取數據（優先級最高）
            let healthNeed = localStorage.getItem('userHealthNeed');
            let lifestyle = localStorage.getItem('userLifestyle');
            let budget = localStorage.getItem('userBudget');
            let productsJson = localStorage.getItem('recommendedProducts');
            
            console.log('從localStorage讀取:', { healthNeed, lifestyle, budget, productsFound: !!productsJson });
            
            // 如果localStorage沒有，嘗試從sessionStorage讀取
            if (!healthNeed) healthNeed = sessionStorage.getItem('userHealthNeed');
            if (!lifestyle) lifestyle = sessionStorage.getItem('userLifestyle');
            if (!budget) budget = sessionStorage.getItem('userBudget');
            if (!productsJson) productsJson = sessionStorage.getItem('recommendedProducts');
            
            console.log('從sessionStorage讀取:', { healthNeed, lifestyle, budget, productsFound: !!productsJson });
            
            // 如果還是沒有，則使用URL參數
            if (!healthNeed && healthParam) {
                healthNeed = healthParam;
                sessionStorage.setItem('userHealthNeed', healthParam);
                localStorage.setItem('userHealthNeed', healthParam);
                console.log('從URL參數設置健康需求:', healthParam);
            }
            
            if (!lifestyle && lifestyleParam) {
                lifestyle = lifestyleParam;
                sessionStorage.setItem('userLifestyle', lifestyleParam);
                localStorage.setItem('userLifestyle', lifestyleParam);
                console.log('從URL參數設置生活型態:', lifestyleParam);
            }
            
            if (!budget && budgetParam) {
                budget = budgetParam;
                sessionStorage.setItem('userBudget', budgetParam);
                localStorage.setItem('userBudget', budgetParam);
                console.log('從URL參數設置預算:', budgetParam);
            }
            
            // 設置默認值，確保一定有數據可用
            if (!healthNeed) healthNeed = '改善睡眠品質';
            if (!lifestyle) lifestyle = '長時間工作';
            if (!budget) budget = '0';
            
            // 直接更新頁面上的顯示
            updateResultsDisplay(healthNeed, lifestyle, budget);
            
            // 如果沒有產品數據，創建備用數據
            if (!productsJson) {
                console.log('沒有找到產品數據，創建備用數據');
                
                // 根據健康需求和生活型態生成相關產品
                generateProductsBasedOnSelections(healthNeed, lifestyle, parseInt(budget));
            } else {
                // 使用已有的產品數據
                console.log('使用現有產品數據');
                displayProducts(JSON.parse(productsJson));
                
                // 同時也更新timeline和cautions
                updateTimeline();
                updateCautions();
            }
        });
        
        // 根據用戶選擇生成相關產品
        function generateProductsBasedOnSelections(healthNeed, lifestyle, budget) {
            console.log('根據選擇生成產品:', { healthNeed, lifestyle, budget });
            
            let products = [];
            
            // 根據不同的健康需求生成相關的產品
            if (healthNeed === '改善睡眠品質') {
                products = [
                    {
                        id: "sleep1",
                        name: "褪黑激素 3mg",
                        brand: "睡眠專家",
                        description: "促進自然睡眠的褪黑激素補充劑，改善入睡時間和睡眠品質。",
                        price: 350,
                        rating: 4.6,
                        image_url: "https://s3.images-iherb.com/now/now03254/y/90.jpg",
                        benefits: ["改善睡眠質量", "縮短入睡時間", "調節生理時鐘"],
                        usage: "睡前30分鐘服用1粒",
                        caution: "白天避免服用，可能導致嗜睡",
                        ingredients: "褪黑激素、植物性膠囊",
                        health_needs: ["改善睡眠品質"],
                        lifestyle_match: [lifestyle],
                        purchase_url: "https://tw.iherb.com/pr/now-foods-melatonin-3-mg-180-tablets/328"
                    },
                    {
                        id: "sleep2",
                        name: "複合鎂補充劑",
                        brand: "營養均衡",
                        description: "含多種形式鎂的複合配方，幫助放鬆肌肉，改善睡眠，緩解壓力。",
                        price: 420,
                        rating: 4.5,
                        image_url: "https://s3.images-iherb.com/cgn/cgn01092/y/24.jpg",
                        benefits: ["肌肉放鬆", "改善睡眠", "減輕壓力"],
                        usage: "每日1-2粒，晚餐時服用",
                        caution: "某些形式的鎂可能有輕微腹瀉作用",
                        ingredients: "甘氨酸鎂、檸檬酸鎂、氧化鎂",
                        health_needs: ["改善睡眠品質", "骨骼與關節健康"],
                        lifestyle_match: [lifestyle],
                        purchase_url: "https://tw.iherb.com/pr/california-gold-nutrition-magnesium-powder-unflavored-8-oz-227-g/94656"
                    }
                ];
            } else if (healthNeed === '增強免疫力') {
                products = [
                    {
                        id: "immune1",
                        name: "維生素C+鋅",
                        brand: "免疫防護",
                        description: "強效抗氧化配方，每片含1000mg維生素C和15mg鋅，幫助增強免疫系統。",
                        price: 380,
                        rating: 4.7,
                        image_url: "https://s3.images-iherb.com/cgn/cgn01092/y/9.jpg",
                        benefits: ["增強免疫力", "抗氧化保護", "促進膠原蛋白形成"],
                        usage: "每日1片，飯後服用",
                        caution: "空腹服用可能導致胃部不適",
                        ingredients: "維生素C、檸檬素、鋅",
                        health_needs: ["增強免疫力"],
                        lifestyle_match: [lifestyle],
                        purchase_url: "https://tw.iherb.com/pr/california-gold-nutrition-vitamin-c-1-000-mg-with-zinc-15-mg-180-tablets/103530"
                    },
                    {
                        id: "immune2",
                        name: "蜂膠膠囊",
                        brand: "自然防禦",
                        description: "天然抗菌配方，含高濃度黃酮類和多酚類抗氧化物，強化免疫系統。",
                        price: 450,
                        rating: 4.4,
                        image_url: "https://s3.images-iherb.com/ydh/ydh17948/y/95.jpg",
                        benefits: ["提升抵抗力", "抗菌抗病毒", "減少發炎反應"],
                        usage: "每日2次，每次1-2粒",
                        caution: "對蜜蜂產品過敏者慎用",
                        ingredients: "蜂膠萃取物、蜂蠟、植物纖維素",
                        health_needs: ["增強免疫力"],
                        lifestyle_match: [lifestyle],
                        purchase_url: "https://tw.iherb.com/pr/y-s-eco-bee-farms-propolis-500-90-capsules/1914"
                    }
                ];
            } else {
                // 其他健康需求的預設產品
                products = [
                    {
                        id: "default1",
                        name: `${healthNeed}專用配方`,
                        brand: "健康專家",
                        description: `針對${healthNeed}需求特別設計的營養補充配方。`,
                        price: 350,
                        rating: 4.6,
                        image_url: "https://s3.images-iherb.com/cgn/cgn01235/y/8.jpg",
                        benefits: ["提升整體健康", "針對性營養補充", "全面保健"],
                        usage: "每日1次，飯後服用",
                        caution: "請遵循包裝說明使用",
                        ingredients: "複合維生素、礦物質、植物萃取物",
                        health_needs: [healthNeed],
                        lifestyle_match: [lifestyle],
                        purchase_url: "https://tw.iherb.com/c/multivitamins"
                    },
                    {
                        id: "default2",
                        name: `生活平衡配方-${lifestyle}適用`,
                        brand: "日常保健",
                        description: `特別針對${lifestyle}生活型態設計的營養支持。`,
                        price: 420,
                        rating: 4.5,
                        image_url: "https://s3.images-iherb.com/nfs/nfs02033/y/32.jpg",
                        benefits: ["提升活力", "平衡營養", "日常保健"],
                        usage: "每日1-2粒，隨餐服用",
                        caution: "兒童、孕婦使用前請諮詢醫師",
                        ingredients: "天然萃取物、維生素複合物",
                        health_needs: [healthNeed],
                        lifestyle_match: [lifestyle],
                        purchase_url: "https://tw.iherb.com/c/energy-formulas"
                    }
                ];
            }
            
            // 根據預算篩選產品
            if (budget > 0) {
                let filteredProducts = products.filter(product => product.price <= budget);
                
                // 如果篩選後沒有產品，添加一個符合預算的基本產品
                if (filteredProducts.length === 0) {
                    filteredProducts.push({
                        id: "budget1",
                        name: `經濟型${healthNeed}配方`,
                        brand: "實惠之選",
                        description: `符合您預算的${healthNeed}基礎保健配方。`,
                        price: Math.min(budget, 500),
                        rating: 4.2,
                        image_url: "https://s3.images-iherb.com/hre/hre00076/y/58.jpg",
                        benefits: ["基礎保健", "經濟實惠", "日常補充"],
                        usage: "每日1次，餐後服用",
                        caution: "請遵循包裝說明使用",
                        ingredients: "基礎維生素、植物萃取物",
                        health_needs: [healthNeed],
                        lifestyle_match: [lifestyle],
                        purchase_url: "https://tw.iherb.com/c/multi-formulas"
                    });
                }
                
                products = filteredProducts;
            }
            
            // 保存產品數據
            localStorage.setItem('recommendedProducts', JSON.stringify(products));
            sessionStorage.setItem('recommendedProducts', JSON.stringify(products));
            
            // 顯示產品
            displayProducts(products);
            
            // 更新時間表和注意事項
            updateTimeline();
            updateCautions();
        }
        
        // 更新結果顯示
        function updateResultsDisplay(healthNeed, lifestyle, budget) {
            console.log('更新頁面顯示:', { healthNeed, lifestyle, budget });
            
            // 更新健康需求和生活型態顯示
            const healthDisplay = document.querySelector('.health-need-display');
            const lifestyleDisplay = document.querySelector('.lifestyle-display');
            
            if (healthDisplay) {
                healthDisplay.textContent = healthNeed || '改善睡眠品質';
            }
            
            if (lifestyleDisplay) {
                lifestyleDisplay.textContent = lifestyle || '長時間工作';
            }
            
            // 更新摘要文本
            const summaryElem = document.querySelector('.selection-summary');
            if (summaryElem) {
                const healthNeedText = healthNeed || '改善睡眠品質';
                const lifestyleText = lifestyle || '長時間工作';
                
                summaryElem.innerHTML = `根據你選擇的「<span class="health-need-display" style="color: var(--primary); font-weight: 600;">${healthNeedText}</span>」需求，以及「<span class="lifestyle-display" style="color: var(--primary); font-weight: 600;">${lifestyleText}</span>」的生活型態，以下是我整理的熱門保健品資訊。`;
            }
            
            // 更新分類標籤
            const categoryBadge = document.querySelector('.result-category');
            if (categoryBadge && healthNeed) {
                if (healthNeed === '改善睡眠品質') {
                    categoryBadge.textContent = '睡眠相關';
                } else if (healthNeed === '增強免疫力') {
                    categoryBadge.textContent = '免疫力相關';
                } else {
                    categoryBadge.textContent = healthNeed;
                }
            }
        }
        
        // 顯示產品
        function displayProducts(products) {
            const container = document.getElementById('recommended-products');
            if (!container) return;
            
            // 清空容器
            container.innerHTML = '';
            
            try {
                if (!products || products.length === 0) {
                    container.innerHTML = '<p class="text-center">暫無推薦產品</p>';
                    return;
                }
                
                // 顯示產品
                products.forEach(product => {
                    const card = document.createElement('div');
                    card.className = 'product-card';
                    
                    // 生成星級評分HTML
                    const ratingStars = generateRatingStars(product.rating || 4.0);
                    
                    // 生成標籤HTML
                    const benefitBadges = (product.benefits || []).map(benefit => 
                        `<span class="badge" style="background-color: var(--primary); margin-right: 4px;">${benefit}</span>`
                    ).join('');
                    
                    // 處理可能的圖片載入錯誤
                    const fallbackImgUrl = "https://images.pexels.com/photos/4046316/pexels-photo-4046316.jpeg?auto=compress&cs=tinysrgb&dpr=2&h=750&w=1260";
                    
                    card.innerHTML = `
                        <img src="${product.image_url || fallbackImgUrl}" alt="${product.name}" 
                             style="width: 100%; height: 180px; object-fit: contain; background-color: #f9f9f9;"
                             onerror="this.onerror=null; this.src='${fallbackImgUrl}';">
                        <div style="padding: 16px;">
                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">
                                <div>
                                    <h3 style="margin: 0; font-size: 18px;">${product.name}</h3>
                                    <p style="margin: 4px 0 0; font-size: 14px; color: var(--text-secondary);">${product.brand || ''}</p>
                                </div>
                                <div style="text-align: right;">
                                    <p style="margin: 0; font-weight: 700; color: var(--primary);">NT$ ${product.price || 0}</p>
                                    <div style="color: #FFB800; font-size: 14px;">${ratingStars}</div>
                                </div>
                            </div>
                            <p style="margin: 8px 0; font-size: 14px; color: var(--text-secondary); line-height: 1.4;">
                                ${product.description || '無產品描述'}
                            </p>
                            <div style="margin: 12px 0 16px;">
                                ${benefitBadges}
                            </div>
                            <a href="${product.purchase_url || 'https://tw.iherb.com'}" target="_blank" class="btn-secondary" style="display: inline-block; text-decoration: none; text-align: center;">查看詳情</a>
                        </div>
                    `;
                    
                    container.appendChild(card);
                });
                
                // 調用產品詳情功能綁定
                bindProductDetailButtons();
                
            } catch (e) {
                console.error('顯示產品時出錯:', e);
                container.innerHTML = '<p class="text-center">加載產品時出錯</p>';
            }
        }
        
        // 綁定產品詳情按鈕事件
        function bindProductDetailButtons() {
            // 這裡可以添加任何額外的按鈕事件處理邏輯
            console.log('產品詳情按鈕已綁定');
        }
        
        // 產品詳情查看函數
        function showProductDetail(productId) {
            try {
                // 從 localStorage 或 sessionStorage 獲取產品數據
                const productsJson = localStorage.getItem('recommendedProducts') || sessionStorage.getItem('recommendedProducts');
                if (!productsJson) {
                    console.error('找不到產品數據');
                    return;
                }
                
                const products = JSON.parse(productsJson);
                const product = products.find(p => p.id === productId);
                
                if (!product) {
                    console.error('找不到指定產品:', productId);
                    return;
                }
                
                // 打開產品購買頁面
                window.open(product.purchase_url || 'https://tw.iherb.com', '_blank');
                
            } catch (error) {
                console.error('顯示產品詳情時出錯:', error);
                alert('無法顯示產品詳情，請稍後重試');
            }
        }
        
        // 生成星級評分
        function generateRatingStars(rating) {
            const fullStars = Math.floor(rating);
            const halfStar = rating % 1 >= 0.5;
            const emptyStars = 5 - fullStars - (halfStar ? 1 : 0);
            
            let starsHtml = '';
            for (let i = 0; i < fullStars; i++) {
                starsHtml += '<i class="fas fa-star"></i>';
            }
            if (halfStar) {
                starsHtml += '<i class="fas fa-star-half-alt"></i>';
            }
            for (let i = 0; i < emptyStars; i++) {
                starsHtml += '<i class="far fa-star"></i>';
            }
            
            return starsHtml;
        }
        
        // 顯示相關產品
        function displayRelatedProducts() {
            const container = document.getElementById('related-products');
            if (!container) return;
            
            // 獲取用戶選擇
            const healthNeed = localStorage.getItem('userHealthNeed') || sessionStorage.getItem('userHealthNeed') || '改善睡眠品質';
            
            // 創建相關產品
            let relatedProducts = [];
            
            if (healthNeed === '改善睡眠品質') {
                relatedProducts = [
                    {
                        id: "related1",
                        name: "舒眠香薰精油",
                        brand: "芳香療法",
                        description: "含薰衣草和洋甘菊的天然精油，幫助放鬆和改善睡眠",
                        price: 380,
                        rating: 4.7,
                        image_url: "https://s3.images-iherb.com/nof/nof02030/y/9.jpg",
                        benefits: ["舒緩放鬆", "改善睡眠環境", "自然芳香"],
                        purchase_url: "https://tw.iherb.com/pr/now-foods-essential-oils-sleep-blend-1-fl-oz-30-ml/22287"
                    },
                    {
                        id: "related2",
                        name: "L-茶氨酸",
                        brand: "放鬆精神",
                        description: "天然放鬆成分，幫助舒緩壓力和提升睡眠品質",
                        price: 350,
                        rating: 4.4,
                        image_url: "https://s3.images-iherb.com/now/now00085/y/4.jpg",
                        benefits: ["促進放鬆", "改善睡眠質量", "不會造成嗜睡"],
                        purchase_url: "https://tw.iherb.com/pr/now-foods-l-theanine-double-strength-200-mg-60-veg-capsules/13431"
                    }
                ];
            } else if (healthNeed === '增強免疫力') {
                relatedProducts = [
                    {
                        id: "related1",
                        name: "蜂王漿膠囊",
                        brand: "蜜蜂精華",
                        description: "富含蛋白質、維生素和礦物質，提供全面營養支持",
                        price: 480,
                        rating: 4.6,
                        image_url: "https://s3.images-iherb.com/ydh/ydh00920/y/27.jpg",
                        benefits: ["增強免疫系統", "提供能量", "營養豐富"],
                        purchase_url: "https://tw.iherb.com/pr/y-s-eco-bee-farms-royal-jelly-in-honey-11-5-oz-326-g/24832"
                    },
                    {
                        id: "related2",
                        name: "有機靈芝萃取液",
                        brand: "天然草本",
                        description: "濃縮靈芝精華，傳統用於調節免疫系統",
                        price: 520,
                        rating: 4.5,
                        image_url: "https://s3.images-iherb.com/snp/snp10000/y/17.jpg",
                        benefits: ["調節免疫", "提高抵抗力", "草本精華"],
                        purchase_url: "https://tw.iherb.com/pr/sun-potion-reishi-mushroom-powder-organic-2-8-oz-80-g/79913"
                    }
                ];
            } else {
                relatedProducts = [
                    {
                        id: "related1",
                        name: "維他命B群",
                        brand: "營養平衡",
                        description: "支持神經系統和能量代謝的關鍵維生素",
                        price: 380,
                        rating: 4.7,
                        image_url: "https://s3.images-iherb.com/cgn/cgn01213/y/32.jpg",
                        benefits: ["提高能量", "減緩疲勞", "支持神經系統"],
                        purchase_url: "https://tw.iherb.com/pr/california-gold-nutrition-b-complex-plus-vitamin-c-30-tablets/64124"
                    },
                    {
                        id: "related2",
                        name: "魚油Omega-3",
                        brand: "海洋精華",
                        description: "富含EPA和DHA的高純度魚油，支持心臟和大腦健康",
                        price: 420,
                        rating: 4.8,
                        image_url: "https://s3.images-iherb.com/nfo/nfo01622/y/0.jpg",
                        benefits: ["心臟健康", "大腦功能", "關節保養"],
                        purchase_url: "https://tw.iherb.com/pr/now-foods-ultra-omega-3-500-epa-250-dha-90-softgels/14903"
                    }
                ];
            }
            
            // 清空容器
            container.innerHTML = '';
            
            // 添加每個相關產品
            relatedProducts.forEach(product => {
                const card = document.createElement('div');
                card.className = 'product-card';
                
                // 生成星級評分HTML
                const ratingStars = generateRatingStars(product.rating || 4.0);
                
                // 生成標籤HTML
                const benefitBadges = (product.benefits || []).map(benefit => 
                    `<span class="badge" style="background-color: var(--secondary); color: var(--text-primary); margin-right: 4px;">${benefit}</span>`
                ).join('');
                
                // 處理可能的圖片載入錯誤
                const fallbackImgUrl = "https://images.pexels.com/photos/4046316/pexels-photo-4046316.jpeg?auto=compress&cs=tinysrgb&dpr=2&h=750&w=1260";
                
                card.innerHTML = `
                    <img src="${product.image_url || fallbackImgUrl}" alt="${product.name}" 
                         style="width: 100%; height: 180px; object-fit: contain; background-color: #f9f9f9;"
                         onerror="this.onerror=null; this.src='${fallbackImgUrl}';">
                    <div style="padding: 16px;">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">
                            <div>
                                <h3 style="margin: 0; font-size: 18px;">${product.name}</h3>
                                <p style="margin: 4px 0 0; font-size: 14px; color: var(--text-secondary);">${product.brand || ''}</p>
                            </div>
                            <div style="text-align: right;">
                                <p style="margin: 0; font-weight: 700; color: var(--primary);">NT$ ${product.price || 0}</p>
                                <div style="color: #FFB800; font-size: 14px;">${ratingStars}</div>
                            </div>
                        </div>
                        <p style="margin: 8px 0; font-size: 14px; color: var(--text-secondary); line-height: 1.4;">
                            ${product.description || '無產品描述'}
                        </p>
                        <div style="margin: 12px 0 16px;">
                            ${benefitBadges}
                        </div>
                        <a href="${product.purchase_url || 'https://tw.iherb.com'}" target="_blank" class="btn-secondary" style="display: inline-block; text-decoration: none; text-align: center;">查看詳情</a>
                    </div>
                `;
                
                container.appendChild(card);
            });
        }
        
        // 更新時間表
        function updateTimeline() {
            const container = document.getElementById('usage-timeline');
            if (!container) return;
            
            // 簡單時間表顯示
            container.innerHTML = `
                <div class="time-point">
                    <div class="time-header">
                        <i class="fas fa-sun"></i>
                        <div class="time-info">
                            <h4>早晨</h4>
                            <p class="time">06:00 - 09:00</p>
                        </div>
                    </div>
                    <div class="time-products">
                        <p>建議服用維他命B群</p>
                    </div>
                </div>
                <div class="time-point">
                    <div class="time-header">
                        <i class="fas fa-moon"></i>
                        <div class="time-info">
                            <h4>睡前</h4>
                            <p class="time">21:00 - 23:00</p>
                        </div>
                    </div>
                    <div class="time-products">
                        <p>建議服用褪黑激素和複合鎂</p>
                    </div>
                </div>
            `;
        }
        
        // 更新注意事項
        function updateCautions() {
            const container = document.getElementById('product-cautions');
            if (!container) return;
            
            // 清空容器
            container.innerHTML = '<h3 style="font-size: 16px; margin: 0 0 12px;">常見注意事項參考</h3>';
            
            // 創建注意事項列表
            const cautionsList = document.createElement('ul');
            cautionsList.className = 'cautions-list';
            cautionsList.style.margin = '0';
            cautionsList.style.paddingLeft = '20px'; 
            cautionsList.style.fontSize = '14px';
            cautionsList.style.color = 'var(--text-secondary)';
            
            // 添加注意事項
            cautionsList.innerHTML = `
                <li><span class="product-name">褪黑激素:</span> 白天避免服用，可能導致嗜睡</li>
                <li><span class="product-name">複合鎂:</span> 某些形式的鎂可能有輕微腹瀉作用</li>
                <li><span class="product-name">所有保健品:</span> 請遵循產品包裝上的指示使用</li>
            `;
            
            container.appendChild(cautionsList);
            
            // 添加免責聲明
            const disclaimer = document.createElement('p');
            disclaimer.style.fontSize = '12px';
            disclaimer.style.color = 'var(--text-secondary)';
            disclaimer.style.marginTop = '12px';
            disclaimer.style.textAlign = 'center';
            disclaimer.textContent = '小帕不提供任何醫療建議，所有資訊僅供參考，請諮詢專業醫師進行健康決策～';
            
            container.appendChild(disclaimer);
        }
    </script>
</body>
</html> 
<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>營養好朋友 - 保健品資訊</title>
    <link rel="stylesheet" href="styles.css">
    <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
    <!-- 頂部導航 -->
    <div class="nav-header">
        <a href="chat.html" style="color: var(--text-primary); margin-right: 12px;">
            <i class="fas fa-arrow-left"></i>
        </a>
        <div style="flex: 1; text-align: center; font-weight: 600;">保健品推薦</div>
        <a href="#" onclick="shareResults()" style="margin-left: 12px; color: var(--text-primary);">
            <i class="fas fa-share-alt"></i>
        </a>
    </div>

    <!-- 結果容器 -->
    <div class="results-container">
        <div class="results-title">
            <h1>專為您定制的保健品方案</h1>
            <p>根據您的健康需求 <span id="user-health-need"></span> 與生活型態 <span id="user-lifestyle"></span>，我們推薦以下保健品：</p>
        </div>

        <div class="product-section">
            <h2>核心推薦</h2>
            <p class="section-description">最適合您需求的保健品</p>
            <div id="recommended-products" class="products-grid">
                <!-- 推薦產品將在這裡動態生成 -->
                <div class="loading-indicator">
                    <i class="fas fa-spinner fa-pulse"></i>
                    <p>正在生成推薦...</p>
                </div>
            </div>
        </div>

        <div class="product-section">
            <h2>輔助推薦</h2>
            <p class="section-description">為增強效果的輔助保健品</p>
            <div id="related-products" class="products-grid">
                <!-- 相關產品將在這裡動態生成 -->
                <div class="loading-indicator">
                    <i class="fas fa-spinner fa-pulse"></i>
                    <p>正在生成推薦...</p>
                </div>
            </div>
        </div>

        <div class="product-section">
            <h2>使用建議時間表</h2>
            <div id="usage-timeline" class="timeline-container">
                <!-- 時間表將在這裡動態生成 -->
                <div class="loading-indicator">
                    <i class="fas fa-spinner fa-pulse"></i>
                    <p>正在生成時間表...</p>
                </div>
            </div>
        </div>

        <div class="product-section">
            <h2>使用注意事項</h2>
            <div id="product-cautions" class="cautions-container">
                <!-- 注意事項將在這裡動態生成 -->
                <div class="loading-indicator">
                    <i class="fas fa-spinner fa-pulse"></i>
                    <p>正在生成注意事項...</p>
                </div>
            </div>
        </div>
    </div>

    <!-- 備用顯示：如果推薦引擎未正確初始化 -->
    <div id="fallback-content" class="fallback-content" style="display: none;">
        <div class="warning-message">
            <i class="fas fa-exclamation-triangle"></i>
            <p>抱歉，無法初始化推薦引擎，請稍後再試。</p>
        </div>
    </div>

    <!-- 底部導航欄 -->
    <div class="tab-bar">
        <a href="home.html" class="tab-item">
            <i class="fas fa-home"></i>
            <span>首頁</span>
        </a>
        <a href="chat.html" class="tab-item">
            <i class="fas fa-comment-medical"></i>
            <span>諮詢</span>
        </a>
        <a href="knowledge.html" class="tab-item">
            <i class="fas fa-book-medical"></i>
            <span>知識庫</span>
        </a>
        <a href="#" class="tab-item">
            <i class="fas fa-user"></i>
            <span>我的</span>
        </a>
    </div>

    <!-- 修正：先載入依賴的資源，確保順序正確 -->
    <script src="js/models/HealthNeedsMapping-fixed.js"></script>
    <!-- 添加修復後的非模組版產品類 -->
    <script src="js/models/Product-fixed.js"></script>
    <script src="js/models/ProductExample-fixed.js"></script>
    <script src="js/recommendationEngine-fixed.js"></script>

    <!-- 然後採用非模組方式的主要邏輯 -->
    <script>
        // 確保在 DOM 載入完成後執行
        document.addEventListener('DOMContentLoaded', function() {
            console.log('results.html 頁面加載完成');
            
            // 顯示備用內容的函數
            function showFallbackContent() {
                document.getElementById('fallback-content').style.display = 'block';
                document.querySelectorAll('.loading-indicator').forEach(el => {
                    el.style.display = 'none';
                });
            }
            
            // 檢查 initializeRecommendations 是否可用
            if (typeof window.initializeRecommendations !== 'function') {
                console.error('找不到推薦引擎函數!');
                showFallbackContent();
                return;
            }
            
            // 1. 獲取用戶輸入
            const urlParams = new URLSearchParams(window.location.search);
            const healthParam = urlParams.get('health');
            const lifestyleParam = urlParams.get('lifestyle');
            const budgetParam = urlParams.get('budget');
            
            console.log('URL參數檢查:', { healthParam, lifestyleParam, budgetParam });
            
            // 1.1 從 localStorage 或 sessionStorage 中獲取，如果 URL 參數不可用
            let healthNeed = healthParam || localStorage.getItem('userHealthNeed') || sessionStorage.getItem('userHealthNeed');
            let lifestyle = lifestyleParam || localStorage.getItem('userLifestyle') || sessionStorage.getItem('userLifestyle');
            let budget = budgetParam ? parseInt(budgetParam) : (localStorage.getItem('userBudget') ? parseInt(localStorage.getItem('userBudget')) : 1000);
            
            // 1.2 如果仍然無法獲取，使用默認值
            if (!healthNeed) healthNeed = '體重管理';
            if (!lifestyle) lifestyle = '長時間使用電子產品';
            if (isNaN(budget)) budget = 1000;
            
            console.log('最終使用的參數:', { healthNeed, lifestyle, budget });
            
            // 2. 更新用戶輸入顯示
            document.getElementById('user-health-need').textContent = healthNeed;
            document.getElementById('user-lifestyle').textContent = lifestyle;
            
            // 3. 使用推薦引擎生成結果
            try {
                window.initializeRecommendations(healthNeed, lifestyle, budget)
                    .then(() => {
                        console.log('推薦引擎初始化成功');
                    })
                    .catch(error => {
                        console.error('推薦引擎初始化失敗:', error);
                        showFallbackContent();
                    });
            } catch (error) {
                console.error('嘗試初始化推薦引擎時出錯:', error);
                showFallbackContent();
            }
        });
        
        // 分享結果功能 (可擴展)
        function shareResults() {
            alert('分享功能即將推出！');
        }
    </script>
</body>
</html> 
<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç‡Ÿé¤Šè«®è©¢ - èˆ‡å°å¸•èŠèŠä½ çš„å¥åº·éœ€æ±‚ | NutriPal</title>
    <meta name="description" content="é€éç°¡å–®å°è©±äº†è§£ä½ çš„å¥åº·éœ€æ±‚ï¼ŒNutriPal å°å¸•æœƒæ ¹æ“šä½ çš„ç”Ÿæ´»ç¿’æ…£æ¨è–¦åˆé©çš„ç‡Ÿé¤Šè£œå……æ–¹æ¡ˆã€‚">
    <meta name="keywords" content="ç‡Ÿé¤Šè«®è©¢,å¥åº·éœ€æ±‚,ç‡Ÿé¤Šè£œå……,ä¿å¥å“æ¨è–¦,NutriPal,å°å¸•">
    <link rel="icon" type="image/x-icon" href="icon_pal.ico">
    <link rel="stylesheet" href="css/styles.css">
    <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700&display=swap" rel="stylesheet" media="print" onload="this.media='all'; this.onload=null;">
    <noscript><link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700&display=swap" rel="stylesheet"></noscript>
    
    <link rel="preload" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
    <noscript><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"></noscript>
</head>
<body>
    <!-- é ‚éƒ¨ç°¡åŒ–å…è²¬è²æ˜ -->
    <div class="top-disclaimer">
        <i class="fas fa-heart"></i>
        <span class="top-disclaimer-text">å°å¸•åƒ…æä¾›ç‡Ÿé¤Šè³‡è¨Šèˆ‡çŸ¥è­˜æ•´ç†ï¼Œä¸æä¾›ä»»ä½•é†«ç™‚è¨ºæ–·ã€æ²»ç™‚æˆ–é é˜²å»ºè­°ï¼Œæ‰€æœ‰å…§å®¹åƒ…ä¾›åƒè€ƒï¼Œå¥åº·æ±ºç­–è«‹è«®è©¢å°ˆæ¥­é†«å¸«ï½</span>
        <button class="top-disclaimer-toggle" onclick="toggleDisclaimer(this)">
            <i class="fas fa-chevron-down"></i>
        </button>
    </div>

    <!-- é ‚éƒ¨å°èˆª -->
    <div class="nav-header">
        <a href="index.html" style="color: var(--text-primary); margin-right: 12px;" /* keep-inline */>
            <i class="fas fa-arrow-left"></i>
        </a>
        <div class="nav-title">å¥åº·çŸ¥è­˜æ•´ç†</div>
        <div class="spacer-24"></div> <!-- ç‚ºäº†ä¿æŒå…©é‚Šå°ç¨± -->
    </div>

    <!-- ä¸»è¦å…§å®¹å€ -->
    <div class="app-content bg-background p-16">
        <!-- å°è©±æµç¨‹ -->
        <div class="chat-message chat-message-animated">
            <div class="avatar avatar-transparent">
                <img src="images/mascot/palpal-avatar.png" alt="å°å¸•" class="avatar-image">
            </div>
            <div class="chat-bubble">
                <p class="text-margin-bottom-8" style="font-weight: 600;" /* keep-inline */>å°å¸• PalPal</p>
                <p class="text-no-margin">å“ˆå›‰å“ˆå›‰ï½æˆ‘æ˜¯ä½ çš„ç‡Ÿé¤ŠçŸ¥è­˜å°å¹«æ‰‹å°å¸•ï¼è¶…ç´šé–‹å¿ƒèƒ½å¹«ä½ æ•´ç†å¥åº·è³‡è¨Šï¼Œä¸€èµ·ä¾†æ‰¾æ‰¾é©åˆä½ çš„ç‡Ÿé¤ŠçŸ¥è­˜å§ï½</p>
            </div>
        </div>

        <div class="chat-message chat-message-animated">
            <div class="avatar avatar-transparent">
                <img src="images/mascot/palpal-avatar.png" alt="å°å¸•" class="avatar-image">
            </div>
            <div class="chat-bubble">
                <p class="text-no-margin">å…ˆå‘Šè¨´æˆ‘ä½ æœ€è¿‘å°å“ªæ–¹é¢çš„å¥åº·çŸ¥è­˜ç‰¹åˆ¥æ„Ÿèˆˆè¶£å‘¢ï¼Ÿæˆ‘æœƒå¹«ä½ æ•´ç†ç›¸é—œçš„ç‡Ÿé¤Šè³‡è¨Šå–”ï½</p>
            </div>
        </div>

        <!-- é¸æ“‡æŒ‰éˆ• -->
        <div class="mb-24">
            <button class="option-button" data-type="health-need" data-value="ç¡çœ ç›¸é—œçŸ¥è­˜" onclick="showLifestyleOptions('ç¡çœ ç›¸é—œçŸ¥è­˜')">
                <div class="d-flex align-items-center">
                    <i class="fas fa-moon icon-with-margin"></i>
                    <div>
                        <p class="text-title">ç¡çœ ç›¸é—œçŸ¥è­˜</p>
                        <p class="text-subtitle">å…¥ç¡æ™‚é–“ã€ç¡çœ é€±æœŸã€ç¡çœ ç’°å¢ƒ</p>
                    </div>
                </div>
            </button>

            <button class="option-button" data-type="health-need" data-value="å…ç–«ç³»çµ±çŸ¥è­˜" onclick="showLifestyleOptions('å…ç–«ç³»çµ±çŸ¥è­˜')">
                <div class="d-flex align-items-center">
                    <i class="fas fa-shield-virus icon-with-margin"></i>
                    <div>
                        <p class="text-title">å…ç–«ç³»çµ±çŸ¥è­˜</p>
                        <p class="text-subtitle">å…ç–«ç³»çµ±åŠŸèƒ½ã€å­£ç¯€æ€§è®ŠåŒ–</p>
                    </div>
                </div>
            </button>

            <button class="option-button" data-type="health-need" data-value="å¥³æ€§å¥åº·çŸ¥è­˜" onclick="showLifestyleOptions('å¥³æ€§å¥åº·çŸ¥è­˜')">
                <div class="d-flex align-items-center">
                    <i class="fas fa-venus icon-with-margin"></i>
                    <div>
                        <p class="text-title">å¥³æ€§å¥åº·çŸ¥è­˜</p>
                        <p class="text-subtitle">å¥³æ€§ç”Ÿç†é€±æœŸã€æ›´å¹´æœŸçŸ¥è­˜</p>
                    </div>
                </div>
            </button>

            <button class="option-button" data-type="health-need" data-value="æ¶ˆåŒ–ç³»çµ±çŸ¥è­˜" onclick="showLifestyleOptions('æ¶ˆåŒ–ç³»çµ±çŸ¥è­˜')">
                <div class="d-flex align-items-center">
                    <i class="fas fa-apple-alt icon-with-margin"></i>
                    <div>
                        <p class="text-title">æ¶ˆåŒ–ç³»çµ±çŸ¥è­˜</p>
                        <p class="text-subtitle">è…¸èƒƒå¥åº·ã€æ¶ˆåŒ–éç¨‹</p>
                    </div>
                </div>
            </button>

            <button class="option-button" data-type="health-need" data-value="é«”é‡ç®¡ç†çŸ¥è­˜" onclick="showLifestyleOptions('é«”é‡ç®¡ç†çŸ¥è­˜')">
                <div class="d-flex align-items-center">
                    <i class="fas fa-weight icon-with-margin"></i>
                    <div>
                        <p class="text-title">é«”é‡ç®¡ç†çŸ¥è­˜</p>
                        <p class="text-subtitle">ä»£è¬çŸ¥è­˜ã€ç‡Ÿé¤Šå‡è¡¡</p>
                    </div>
                </div>
            </button>

            <button class="option-button" data-type="health-need" data-value="å¤§è…¦èˆ‡èªçŸ¥çŸ¥è­˜" onclick="showLifestyleOptions('å¤§è…¦èˆ‡èªçŸ¥çŸ¥è­˜')">
                <div class="d-flex align-items-center">
                    <i class="fas fa-brain icon-with-margin"></i>
                    <div>
                        <p class="text-title">å¤§è…¦èˆ‡èªçŸ¥çŸ¥è­˜</p>
                        <p class="text-subtitle">èªçŸ¥åŠŸèƒ½ã€å¤§è…¦ç‡Ÿé¤Šç´ </p>
                    </div>
                </div>
            </button>

            <button class="option-button" data-type="health-need" data-value="å¿ƒè¡€ç®¡ç³»çµ±çŸ¥è­˜" onclick="showLifestyleOptions('å¿ƒè¡€ç®¡ç³»çµ±çŸ¥è­˜')">
                <div class="d-flex align-items-center">
                    <i class="fas fa-heartbeat icon-with-margin"></i>
                    <div>
                        <p class="text-title">å¿ƒè¡€ç®¡ç³»çµ±çŸ¥è­˜</p>
                        <p class="text-subtitle">å¿ƒè‡ŸåŠŸèƒ½ã€è¡€ç®¡å¥åº·çŸ¥è­˜</p>
                    </div>
                </div>
            </button>
            
            <button class="option-button" data-type="health-need" data-value="éª¨éª¼èˆ‡é—œç¯€çŸ¥è­˜" onclick="showLifestyleOptions('éª¨éª¼èˆ‡é—œç¯€çŸ¥è­˜')">
                <div class="d-flex align-items-center">
                    <i class="fas fa-bone icon-with-margin"></i>
                    <div>
                        <p class="text-title">éª¨éª¼èˆ‡é—œç¯€çŸ¥è­˜</p>
                        <p class="text-subtitle">é—œç¯€é‹å‹•ã€éª¨è³ªå¯†åº¦çŸ¥è­˜</p>
                    </div>
                </div>
            </button>
            
            <button class="option-button" data-type="health-need" data-value="è¦–åŠ›ä¿å¥çŸ¥è­˜" onclick="showLifestyleOptions('è¦–åŠ›ä¿å¥çŸ¥è­˜')">
                <div class="d-flex align-items-center">
                    <i class="fas fa-eye icon-with-margin"></i>
                    <div>
                        <p class="text-title">è¦–åŠ›ä¿å¥çŸ¥è­˜</p>
                        <p class="text-subtitle">ç”¨çœ¼ç¿’æ…£ã€è¦–åŠ›ä¿é¤ŠçŸ¥è­˜</p>
                    </div>
                </div>
            </button>
            
            <button class="option-button" data-type="health-need" data-value="è‚è‡Ÿä¿å¥çŸ¥è­˜" onclick="showLifestyleOptions('è‚è‡Ÿä¿å¥çŸ¥è­˜')">
                <div class="d-flex align-items-center">
                    <i class="fas fa-tint icon-with-margin"></i>
                    <div>
                        <p class="text-title">è‚è‡Ÿä¿å¥çŸ¥è­˜</p>
                        <p class="text-subtitle">è‚è‡ŸåŠŸèƒ½ã€ä»£è¬çŸ¥è­˜</p>
                    </div>
                </div>
            </button>
            
            <button class="option-button" data-type="health-need" data-value="å…¶ä»–" onclick="showLifestyleOptions('å…¶ä»–å¥åº·çŸ¥è­˜')">
                <div class="d-flex align-items-center">
                    <i class="fas fa-plus icon-with-margin"></i>
                    <div>
                        <p class="text-title">å…¶ä»–å¥åº·çŸ¥è­˜</p>
                        <p class="text-subtitle">è¼¸å…¥æ‚¨æƒ³äº†è§£çš„å¥åº·ä¸»é¡Œ</p>
                    </div>
                </div>
            </button>
            
            <!-- åº•éƒ¨é¡å¤–é–“è·ï¼Œç¢ºä¿æŒ‰éˆ•ä¸è¢«å°èˆªæ¬„é®æ“‹ -->
            <div class="spacer-height-30"></div>
        </div>

        <div id="health-need-response" class="display-none">
        <div class="chat-message right chat-message-animated">
            <div class="chat-bubble user">
                    <p class="text-no-margin">æˆ‘æƒ³äº†è§£<span class="selected-health-need"></span></p>
            </div>
        </div>

        <div class="chat-message chat-message-animated">
                <div class="avatar avatar-transparent">
                    <img src="images/mascot/palpal-avatar.png" alt="å°å¸•" class="avatar-image">
            </div>
            <div class="chat-bubble">
                    <p class="text-no-margin">å¤ªæ£’äº†ï¼<span class="health-need-feedback"></span>å°å¸•æ¥ä¸‹ä¾†æƒ³çŸ¥é“ä½ çš„ç”Ÿæ´»å‹æ…‹æ˜¯æ€æ¨£çš„å‘¢ï¼Ÿé€™æ¨£æ‰èƒ½å¹«ä½ æ‰¾åˆ°æ›´é©åˆçš„å¥åº·çŸ¥è­˜è³‡è¨Šå–”ï½</p>
                </div>
            </div>
        </div>

        <!-- ç”Ÿæ´»å‹æ…‹é¸é … -->
        <div id="lifestyle-options" class="mb-24 display-none">
            <button class="option-button" data-type="lifestyle" data-value="é•·æ™‚é–“å·¥ä½œ" onclick="showBudgetOptions('é•·æ™‚é–“å·¥ä½œ')">
                <div class="d-flex align-items-center">
                    <i class="fas fa-briefcase icon-with-margin"></i>
                    <div>
                        <p class="text-title">é•·æ™‚é–“å·¥ä½œ</p>
                        <p class="text-subtitle">å·¥ä½œå£“åŠ›å¤§ã€ä¹…å</p>
                    </div>
                </div>
            </button>

            <button class="option-button" data-type="lifestyle" data-value="ç¶“å¸¸é‹å‹•" onclick="showBudgetOptions('ç¶“å¸¸é‹å‹•')">
                <div class="d-flex align-items-center">
                    <i class="fas fa-running icon-with-margin"></i>
                    <div>
                        <p class="text-title">ç¶“å¸¸é‹å‹•</p>
                        <p class="text-subtitle">å¥èº«ã€è·‘æ­¥ç­‰é‹å‹•</p>
                    </div>
                </div>
            </button>

            <button class="option-button" data-type="lifestyle" data-value="é£²é£Ÿä¸è¦å¾‹" onclick="showBudgetOptions('é£²é£Ÿä¸è¦å¾‹')">
                <div class="d-flex align-items-center">
                    <i class="fas fa-hamburger icon-with-margin"></i>
                    <div>
                        <p class="text-title">é£²é£Ÿä¸è¦å¾‹</p>
                        <p class="text-subtitle">å¤–é£Ÿå¤šã€ä¸å®šæ™‚é€²é£Ÿ</p>
                    </div>
                </div>
            </button>

            <button class="option-button" data-type="lifestyle" data-value="é•·æ™‚é–“ä½¿ç”¨é›»å­ç”¢å“" onclick="showBudgetOptions('é•·æ™‚é–“ä½¿ç”¨é›»å­ç”¢å“')">
                <div class="d-flex align-items-center">
                    <i class="fas fa-laptop icon-with-margin"></i>
                    <div>
                        <p class="text-title">é•·æ™‚é–“ä½¿ç”¨é›»å­ç”¢å“</p>
                        <p class="text-subtitle">é›»è…¦ã€æ‰‹æ©Ÿã€å¹³æ¿</p>
                    </div>
                </div>
            </button>

            <button class="option-button" data-type="lifestyle" data-value="ç¶“å¸¸ç†¬å¤œ" onclick="showBudgetOptions('ç¶“å¸¸ç†¬å¤œ')">
                <div class="d-flex align-items-center">
                    <i class="fas fa-hourglass-half icon-with-margin"></i>
                    <div>
                        <p class="text-title">ç¶“å¸¸ç†¬å¤œ</p>
                        <p class="text-subtitle">ç¡çœ ä¸è¦å¾‹ã€ç¡çœ å“è³ªå·®</p>
                    </div>
                </div>
            </button>

            <button class="option-button" data-type="lifestyle" data-value="ç¶“å¸¸å¤–é£Ÿ" onclick="showBudgetOptions('ç¶“å¸¸å¤–é£Ÿ')">
                <div class="d-flex align-items-center">
                    <i class="fas fa-utensils icon-with-margin"></i>
                    <div>
                        <p class="text-title">ç¶“å¸¸å¤–é£Ÿ</p>
                        <p class="text-subtitle">å¤–é£Ÿã€å¤–é€ã€ä¾¿åˆ©å•†åº—</p>
                    </div>
                </div>
            </button>
        </div>

        <div id="lifestyle-response" class="display-none">
            <div class="chat-message right chat-message-animated">
                <div class="chat-bubble user">
                    <p class="text-no-margin">æˆ‘çš„ç”Ÿæ´»å‹æ…‹æ˜¯<span class="selected-lifestyle"></span></p>
                </div>
            </div>

            <div class="chat-message chat-message-animated">
                <div class="avatar avatar-transparent">
                    <img src="images/mascot/palpal-avatar.png" alt="å°å¸•" class="avatar-image">
                </div>
                <div class="chat-bubble">
                    <p class="text-no-margin">è¬è¬ä½ å‘Šè¨´æˆ‘é€™äº›ï¼æœ€å¾Œä¸€å€‹å°å•é¡Œï½æœ‰æ²’æœ‰é ç®—ä¸Šçš„è€ƒé‡å‘¢ï¼Ÿå°å¸•æœƒåŠªåŠ›æ‰¾å‡ºæœ€ç¬¦åˆä½ éœ€æ±‚çš„åƒè€ƒè³‡è¨Šï½</p>
                </div>
            </div>
        </div>

        <!-- é ç®—é¸é … -->
        <div id="budget-options" class="mb-60 display-none">
            <a href="results.html" onclick="saveSelectionAndRedirect('500', event)" class="option-button" data-type="budget" data-value="500" style="text-decoration: none; color: inherit;" /* keep-inline */>
                <div class="d-flex align-items-center">
                    <i class="fas fa-dollar-sign icon-with-margin"></i>
                    <div>
                        <p class="text-title">ç¶“æ¿Ÿå¯¦æƒ å‹ï¼ˆ500å…ƒä»¥ä¸‹ï¼‰</p>
                        <p class="text-subtitle">åŸºæœ¬éœ€æ±‚ï¼Œå¹³åƒ¹é¸æ“‡</p>
                    </div>
                </div>
            </a>

            <a href="results.html" onclick="saveSelectionAndRedirect('1000', event)" class="option-button" data-type="budget" data-value="1000" style="text-decoration: none; color: inherit;" /* keep-inline */>
                <div class="d-flex align-items-center">
                    <i class="fas fa-dollar-sign icon-with-margin"></i>
                    <div>
                        <p class="text-title">ä¸­ç­‰é ç®—ï¼ˆ500-1000å…ƒï¼‰</p>
                        <p class="text-subtitle">æ€§åƒ¹æ¯”é«˜ï¼Œå“è³ªä¿è­‰</p>
                    </div>
                </div>
            </a>

            <a href="results.html" onclick="saveSelectionAndRedirect('2000', event)" class="option-button" data-type="budget" data-value="2000" style="text-decoration: none; color: inherit;" /* keep-inline */>
                <div class="d-flex align-items-center">
                    <i class="fas fa-dollar-sign icon-with-margin"></i>
                    <div>
                        <p class="text-title">é«˜å“è³ªå‹ï¼ˆ1000å…ƒä»¥ä¸Šï¼‰</p>
                        <p class="text-subtitle">é«˜æª”å“ç‰Œï¼Œå°ˆæ¥­é…æ–¹</p>
                    </div>
                </div>
            </a>

            <a href="results.html" onclick="saveSelectionAndRedirect('0', event)" class="option-button" data-type="budget" data-value="0" style="text-decoration: none; color: inherit;" /* keep-inline */>
                <div class="d-flex align-items-center">
                    <i class="fas fa-infinity icon-with-margin"></i>
                    <div>
                        <p class="text-title">ç„¡é ç®—é™åˆ¶</p>
                        <p class="text-subtitle">å„ªå…ˆè€ƒæ…®æ•ˆæœèˆ‡å“è³ª</p>
                    </div>
                </div>
            </a>
            
            <!-- åº•éƒ¨é¡å¤–é–“è·ï¼Œé˜²æ­¢è¢«å°èˆªæ¬„é®æ“‹ -->
            <div class="spacer-height-50"></div>
        </div>

        <div id="budget-response" class="display-none mb-40">
            <div class="chat-message right chat-message-animated">
                <div class="chat-bubble user">
                    <p class="text-no-margin">æˆ‘é¸æ“‡<span class="selected-budget"></span></p>
                </div>
            </div>

            <div class="chat-message chat-message-animated">
                <div class="avatar avatar-transparent">
                    <img src="images/mascot/palpal-avatar.png" alt="å°å¸•" class="avatar-image">
                </div>
                <div class="chat-bubble">
                    <p class="text-no-margin">æ”¶åˆ°æ”¶åˆ°ï¼å°å¸•å·²ç¶“è¨˜ä¸‹ä½ çš„éœ€æ±‚å•¦ï½ç¾åœ¨å°±ä¾†å¹«ä½ æ•´ç†ç†±é–€çš„å¥åº·çŸ¥è­˜è³‡è¨Šï¼Œå¸Œæœ›èƒ½å¹«åˆ°ä½ å–”ï¼</p>
                </div>
            </div>
        </div>

        <!-- æäº¤æŒ‰éˆ•å€åŸŸ - æ¢å¾©åˆ°å°è©±æµç¨‹ä¸­ï¼Œä½†ä½¿ç”¨æ›´å¯é çš„æ–¹å¼ -->
        <div id="submit-container" class="mt-24 display-none">
            <a href="results.html" id="submit-selections" class="btn-primary btn-full-width" style="padding: 12px; border-radius: 8px;" /* keep-inline */ onclick="saveSelectionsBeforeRedirect(event)">
                ç²å–ä¿å¥å“æ¨è–¦
            </a>
            
            <!-- åŠ è¼‰æŒ‡ç¤ºå™¨ -->
            <div id="loading-indicator" style="display: none; text-align: center; margin-top: 20px;" /* keep-inline */>
                <div class="loading-spinner"></div>
                <p>æ­£åœ¨æ•´ç†ä¿å¥å“è³‡è¨Šï¼Œè«‹ç¨å€™...</p>
            </div>
        </div>

        <!-- æ·»åŠ ä¸€å€‹éš±è—çš„è¡¨å–®ï¼Œç”¨æ–¼æ›´å¯é çš„é é¢è·³è½‰ -->
        <form id="navigation-form" action="results.html" method="get" class="display-none">
            <input type="hidden" name="health" value="">
            <input type="hidden" name="lifestyle" value="">
            <input type="hidden" name="budget" value="">
            <input type="hidden" name="time" value="">
        </form>

        <!-- éš±è—çš„èª¿è©¦å·¥å…· -->
        <div id="debug-tools" style="display: none; margin-top: 20px; border-top: 1px dashed #ccc; padding-top: 20px;" /* keep-inline debug tool */>
            <h4 style="text-align: center; margin-bottom: 15px;" /* keep-inline debug tool */>é–‹ç™¼éšæ®µèª¿è©¦å·¥å…·</h4>
            <div class="flex-center">
                <button id="debug-show-data" class="btn-secondary" style="font-size: 12px;" /* keep-inline debug tool */>
                    é¡¯ç¤ºsessionStorageæ•¸æ“š
                </button>
                <button id="debug-test-redirect" class="btn-secondary" style="font-size: 12px;" /* keep-inline debug tool */>
                    æ¸¬è©¦é é¢è·³è½‰
            </button>
                <button id="debug-clear-data" class="btn-secondary" style="font-size: 12px;" /* keep-inline debug tool */>
                    æ¸…é™¤æ‰€æœ‰æ•¸æ“š
            </button>
            </div>
            <div id="debug-output" style="margin-top: 10px; padding: 10px; background: #f5f5f5; border-radius: 4px; font-family: monospace; font-size: 12px; white-space: pre-wrap; max-height: 200px; overflow: auto; display: none;" /* keep-inline debug tool */></div>
        </div>
    </div>

    <!-- åº•éƒ¨å°èˆªæ¬„ -->
    <div class="tab-bar">
        <a href="index.html" class="tab-item">
            <i class="fas fa-home"></i>
            <span>é¦–é </span>
        </a>
        <a href="chat.html" class="tab-item active">
            <i class="fas fa-comment-medical"></i>
            <span>è«®è©¢</span>
        </a>
        <a href="knowledge.html" class="tab-item">
            <i class="fas fa-book-medical"></i>
            <span>çŸ¥è­˜åº«</span>
        </a>
    </div>

    <!-- å¼•å…¥è…³æœ¬ - ä¿®æ”¹é †åºç¢ºä¿ä¾è³´é—œä¿‚æ­£ç¢º -->
    <script src="js/iherb-reward-config.js"></script>
    <script src="js/models/HealthNeedsMapping-fixed.js"></script>
    <!-- æ·»åŠ ä¿®å¾©å¾Œçš„éæ¨¡çµ„ç‰ˆç”¢å“é¡ -->
    <script src="js/models/Product-fixed.js"></script>
    <!-- ç§»é™¤ä¸å­˜åœ¨çš„ JS æ–‡ä»¶å¼•ç”¨ -->
    <script src="js/main.js"></script>

    <!-- ç¢ºä¿æŒ‰éˆ•é»æ“Šäº‹ä»¶ -->
    <script>
    // åˆå§‹åŒ–çª—å£ç”¨æˆ¶é¸æ“‡å°è±¡ - ç¢ºä¿å®ƒæ˜¯å…¨å±€å°è±¡
    window.userSelections = {
        healthNeed: '',
        lifestyle: '',
        budget: 0
    };

    // ğŸ¯ æ™ºèƒ½å¥åº·éœ€æ±‚åƒæ•¸è™•ç†å‡½æ•¸
    function handlePreselectedHealthNeed() {
        const urlParams = new URLSearchParams(window.location.search);
        const preselectedHealth = urlParams.get('health');
        
        if (preselectedHealth) {
            console.log('ğŸ” æª¢æ¸¬åˆ°é é¸å¥åº·éœ€æ±‚:', preselectedHealth);
            
            // å°‹æ‰¾åŒ¹é…çš„æŒ‰éˆ•ä¸¦è‡ªå‹•é¸æ“‡
            const matchingButton = findMatchingHealthButton(preselectedHealth);
            if (matchingButton) {
                console.log('âœ… æ‰¾åˆ°åŒ¹é…æŒ‰éˆ•ï¼Œæº–å‚™è‡ªå‹•é¸æ“‡');
                
                // é¡¯ç¤ºå°å¸•çš„ç¢ºèªå°è©±
                showPreselectionConfirmation(preselectedHealth);
                
                // å»¶é²è‡ªå‹•è§¸ç™¼é¸æ“‡æµç¨‹ï¼Œè®“ç”¨æˆ¶çœ‹åˆ°ç¢ºèª
                setTimeout(() => {
                    matchingButton.click();
                    
                    // å¹³æ»‘æ»¾å‹•åˆ°ç”Ÿæ´»å‹æ…‹é¸é …
                    setTimeout(() => {
                        const lifestyleOptions = document.getElementById('lifestyle-options');
                        if (lifestyleOptions && lifestyleOptions.style.display !== 'none') {
                            lifestyleOptions.scrollIntoView({ 
                                behavior: 'smooth', 
                                block: 'center' 
                            });
                        }
                    }, 800);
                }, 1500);
            } else {
                console.warn('âš ï¸ ç„¡æ³•æ‰¾åˆ°åŒ¹é…çš„å¥åº·éœ€æ±‚æŒ‰éˆ•:', preselectedHealth);
            }
        }
    }

    // ğŸ”„ æ™ºèƒ½åŒ¹é…å¥åº·éœ€æ±‚æŒ‰éˆ•
    function findMatchingHealthButton(healthNeed) {
        console.log('ğŸ” å˜—è©¦åŒ¹é…å¥åº·éœ€æ±‚:', healthNeed);
        
        // å»ºç«‹å¥åº·éœ€æ±‚å°æ‡‰é—œä¿‚è¡¨ï¼Œè™•ç†å‘½åä¸ä¸€è‡´å•é¡Œ
        const healthMapping = {
            // å®Œå…¨åŒ¹é…çš„é¸é …
            'ç¡çœ ç›¸é—œçŸ¥è­˜': 'ç¡çœ ç›¸é—œçŸ¥è­˜',
            'å…ç–«ç³»çµ±çŸ¥è­˜': 'å…ç–«ç³»çµ±çŸ¥è­˜', 
            'å¤§è…¦èˆ‡èªçŸ¥çŸ¥è­˜': 'å¤§è…¦èˆ‡èªçŸ¥çŸ¥è­˜',
            'éª¨éª¼èˆ‡é—œç¯€çŸ¥è­˜': 'éª¨éª¼èˆ‡é—œç¯€çŸ¥è­˜',
            'å¿ƒè¡€ç®¡ç³»çµ±çŸ¥è­˜': 'å¿ƒè¡€ç®¡ç³»çµ±çŸ¥è­˜',
            'æ¶ˆåŒ–ç³»çµ±çŸ¥è­˜': 'æ¶ˆåŒ–ç³»çµ±çŸ¥è­˜',
            'å¥³æ€§å¥åº·çŸ¥è­˜': 'å¥³æ€§å¥åº·çŸ¥è­˜',
            'è‚è‡Ÿä¿å¥çŸ¥è­˜': 'è‚è‡Ÿä¿å¥çŸ¥è­˜',
            
            // è™•ç†å‘½åä¸ä¸€è‡´çš„å°æ‡‰é—œä¿‚
            'çœ¼ç›ä¿å¥çŸ¥è­˜': 'è¦–åŠ›ä¿å¥çŸ¥è­˜',
            'è¦–åŠ›ä¿å¥çŸ¥è­˜': 'è¦–åŠ›ä¿å¥çŸ¥è­˜',
            'çš®è†šä¿é¤ŠçŸ¥è­˜': 'å…¶ä»–',
            'è‚Œè‚‰ç‡Ÿé¤ŠçŸ¥è­˜': 'å…¶ä»–', 
            'èƒ½é‡èˆ‡æ´»åŠ›çŸ¥è­˜': 'å…¶ä»–',
            'ç”·æ€§å¥åº·çŸ¥è­˜': 'å…¶ä»–',
            'æŠ—æ°§åŒ–ç‡Ÿé¤ŠçŸ¥è­˜': 'å…¶ä»–',
            'åŸºç¤ç‡Ÿé¤ŠçŸ¥è­˜': 'å…¶ä»–',
            'éæ•ç›¸é—œçŸ¥è­˜': 'å…¶ä»–',
            
            // æ¨¡ç³ŠåŒ¹é…è¦å‰‡
            'ç¡çœ ': 'ç¡çœ ç›¸é—œçŸ¥è­˜',
            'å…ç–«': 'å…ç–«ç³»çµ±çŸ¥è­˜',
            'å¤§è…¦': 'å¤§è…¦èˆ‡èªçŸ¥çŸ¥è­˜',
            'èªçŸ¥': 'å¤§è…¦èˆ‡èªçŸ¥çŸ¥è­˜',
            'è¨˜æ†¶': 'å¤§è…¦èˆ‡èªçŸ¥çŸ¥è­˜',
            'éª¨éª¼': 'éª¨éª¼èˆ‡é—œç¯€çŸ¥è­˜',
            'é—œç¯€': 'éª¨éª¼èˆ‡é—œç¯€çŸ¥è­˜',
            'å¿ƒè¡€ç®¡': 'å¿ƒè¡€ç®¡ç³»çµ±çŸ¥è­˜',
            'å¿ƒè‡Ÿ': 'å¿ƒè¡€ç®¡ç³»çµ±çŸ¥è­˜',
            'æ¶ˆåŒ–': 'æ¶ˆåŒ–ç³»çµ±çŸ¥è­˜',
            'è…¸èƒƒ': 'æ¶ˆåŒ–ç³»çµ±çŸ¥è­˜',
            'çœ¼ç›': 'è¦–åŠ›ä¿å¥çŸ¥è­˜',
            'è¦–åŠ›': 'è¦–åŠ›ä¿å¥çŸ¥è­˜',
            'å¥³æ€§': 'å¥³æ€§å¥åº·çŸ¥è­˜',
            'è‚è‡Ÿ': 'è‚è‡Ÿä¿å¥çŸ¥è­˜'
        };
        
        // é¦–å…ˆå˜—è©¦ç²¾ç¢ºåŒ¹é…
        let mappedValue = healthMapping[healthNeed];
        
        // å¦‚æœæ²’æœ‰ç²¾ç¢ºåŒ¹é…ï¼Œå˜—è©¦æ¨¡ç³ŠåŒ¹é…
        if (!mappedValue) {
            for (const [key, value] of Object.entries(healthMapping)) {
                if (healthNeed.includes(key) || key.includes(healthNeed)) {
                    mappedValue = value;
                    console.log('ğŸ¯ æ¨¡ç³ŠåŒ¹é…æˆåŠŸ:', healthNeed, '->', mappedValue);
                    break;
                }
            }
        }
        
        // å¦‚æœé‚„æ˜¯æ²’æœ‰åŒ¹é…ï¼Œä½¿ç”¨åŸå€¼
        if (!mappedValue) {
            mappedValue = healthNeed;
            console.log('âš ï¸ ä½¿ç”¨åŸå€¼å˜—è©¦åŒ¹é…:', mappedValue);
        }
        
        const button = document.querySelector(`button[data-type="health-need"][data-value="${mappedValue}"]`);
        console.log('ğŸ” æŸ¥æ‰¾æŒ‰éˆ•çµæœ:', mappedValue, button ? 'æ‰¾åˆ°' : 'æœªæ‰¾åˆ°');
        
        return button;
    }

    // ğŸ’¬ é¡¯ç¤ºé é¸ç¢ºèªå°è©±
    function showPreselectionConfirmation(healthNeed) {
        // åœ¨ç¬¬ä¸€å€‹å°è©±æ¡†å¾Œæ’å…¥ç¢ºèªå°è©±
        const firstChatMessage = document.querySelector('.chat-message');
        if (firstChatMessage) {
            const confirmationHTML = `
                <div class="chat-message chat-message-animated" id="preselection-confirmation" style="opacity: 0;">
                    <div class="avatar avatar-transparent">
                        <img src="images/mascot/palpal-avatar.png" alt="å°å¸•" class="avatar-image">
                    </div>
                    <div class="chat-bubble">
                        <p class="text-no-margin">æˆ‘çœ‹åˆ°ä½ å°ã€Œ<strong>${healthNeed}</strong>ã€ç‰¹åˆ¥æ„Ÿèˆˆè¶£ï¼è®“æˆ‘ç›´æ¥ç‚ºä½ æº–å‚™ç›¸é—œçš„è³‡è¨Šæ•´ç†ï½</p>
                    </div>
                </div>
            `;
            
            firstChatMessage.insertAdjacentHTML('afterend', confirmationHTML);
            
            // æ·»åŠ æ¼¸å…¥å‹•ç•«
            setTimeout(() => {
                const confirmationElement = document.getElementById('preselection-confirmation');
                if (confirmationElement) {
                    confirmationElement.style.opacity = '1';
                }
            }, 500);
        }
    }

    // ç›´æ¥é€šéé ç®—æŒ‰éˆ•è·³è½‰çš„å‡½æ•¸
    function saveSelectionAndRedirect(budget, event) {
        // é˜»æ­¢é»˜èªè¡Œç‚ºï¼Œæˆ‘å€‘å°‡åœ¨ä¿å­˜æ•¸æ“šå¾Œæ‰‹å‹•è·³è½‰
        event.preventDefault();
        
        console.log('é»æ“Šäº†é ç®—æŒ‰éˆ•ï¼Œæº–å‚™ä¿å­˜æ•¸æ“šä¸¦è·³è½‰');

        // æ›´æ–°é ç®—é¸æ“‡
        window.userSelections.budget = parseInt(budget, 10) || 0;
        
        // å†æ¬¡ç¢ºèªå¥åº·éœ€æ±‚å’Œç”Ÿæ´»å‹æ…‹å·²è¢«ä¿å­˜
        const selectedHealthButton = document.querySelector('button[data-type="health-need"].selected');
        if (selectedHealthButton) {
            window.userSelections.healthNeed = selectedHealthButton.getAttribute('data-value');
        } else {
            console.warn('ç„¡æ³•æ‰¾åˆ°å·²é¸æ“‡çš„å¥åº·éœ€æ±‚æŒ‰éˆ•ï¼Œå°‡ä½¿ç”¨ sessionStorage çš„å€¼');
            window.userSelections.healthNeed = sessionStorage.getItem('userHealthNeed') || 'ç¡çœ ç›¸é—œçŸ¥è­˜';
        }
        
        const selectedLifestyleButton = document.querySelector('button[data-type="lifestyle"].selected');
        if (selectedLifestyleButton) {
            window.userSelections.lifestyle = selectedLifestyleButton.getAttribute('data-value');
        } else {
            console.warn('ç„¡æ³•æ‰¾åˆ°å·²é¸æ“‡çš„ç”Ÿæ´»å‹æ…‹æŒ‰éˆ•ï¼Œå°‡ä½¿ç”¨ sessionStorage çš„å€¼');
            window.userSelections.lifestyle = sessionStorage.getItem('userLifestyle') || 'é•·æ™‚é–“å·¥ä½œ';
        }
        
        console.log('ç”¨æˆ¶æœ€çµ‚é¸æ“‡:', window.userSelections);
        
        // ä½¿ç”¨ localStorageï¼Œå› ç‚ºå®ƒçš„å¯é æ€§æ›´é«˜
        try {
            localStorage.setItem('userHealthNeed', window.userSelections.healthNeed);
            localStorage.setItem('userLifestyle', window.userSelections.lifestyle);
            localStorage.setItem('userBudget', window.userSelections.budget);
            console.log('å·²å°‡ç”¨æˆ¶é¸æ“‡æˆåŠŸå„²å­˜åˆ° localStorage');
        } catch (e) {
            console.error('å„²å­˜åˆ° localStorage å¤±æ•—:', e);
            // ä½œç‚ºå‚™ç”¨ï¼Œå†æ¬¡å˜—è©¦ sessionStorage
            sessionStorage.setItem('userHealthNeed', window.userSelections.healthNeed);
            sessionStorage.setItem('userLifestyle', window.userSelections.lifestyle);
            sessionStorage.setItem('userBudget', window.userSelections.budget);
        }
        
        // é¡¯ç¤ºé ç®—é¸æ“‡çš„ç”¨æˆ¶å›æ‡‰
        const budgetResponse = document.getElementById('budget-response');
        if (budgetResponse) {
            budgetResponse.style.display = 'block';
            const selectedBudgetSpan = budgetResponse.querySelector('.selected-budget');
            if (selectedBudgetSpan) {
                const budgetButton = document.querySelector(`a[data-value="${budget}"]`);
                selectedBudgetSpan.textContent = budgetButton ? budgetButton.querySelector('p:first-child').textContent : '';
            }
        }
        
        // å»¶é²è·³è½‰ï¼Œè®“ç”¨æˆ¶çœ‹åˆ°é ç®—é¸æ“‡çš„å›æ‡‰
        setTimeout(function() {
            // å„ªå…ˆä½¿ç”¨ localStorage çš„è³‡æ–™ä¾†å»ºç«‹ URLï¼Œç¢ºä¿è³‡æ–™ä¸€è‡´æ€§
            const health = localStorage.getItem('userHealthNeed');
            const lifestyle = localStorage.getItem('userLifestyle');
            const userBudget = localStorage.getItem('userBudget');
            
            const params = new URLSearchParams();
            params.append('health', health);
            params.append('lifestyle', lifestyle);
            params.append('budget', userBudget);
            
            // è·³è½‰åˆ°çµæœé é¢ï¼Œä¸¦å¸¶ä¸Šå¯é çš„åƒæ•¸
            window.location.href = 'results.html?' + params.toString();
        }, 1500);
    }

    document.addEventListener('DOMContentLoaded', function() {
        console.log('é é¢åŠ è¼‰å®Œæˆï¼Œåˆå§‹åŒ–è‡ªå®šç¾©äº‹ä»¶è™•ç†');
        
        // ğŸš€ æ™ºèƒ½åƒæ•¸è™•ç†ï¼šè™•ç†å¾ index.html å‚³ä¾†çš„å¥åº·éœ€æ±‚åƒæ•¸
        handlePreselectedHealthNeed();
        
        // ç¢ºä¿æäº¤æŒ‰éˆ•åˆå§‹ç‹€æ…‹ç‚ºéš±è—
        const submitContainer = document.getElementById('submit-container');
        if(submitContainer) {
            console.log('ç¢ºä¿æäº¤æŒ‰éˆ•åˆå§‹éš±è—');
            submitContainer.style.display = 'none';
        }
        
        // ç‰¹æ®Šé‚è¼¯ï¼šç¢ºä¿æäº¤æŒ‰éˆ•åœ¨ä»»ä½•ç’°å¢ƒä¸‹éƒ½å¯è¦‹ - é©ç”¨æ–¼æ‰€æœ‰ç’°å¢ƒ
        setTimeout(function() {
            // æª¢æŸ¥æ˜¯å¦å·²ç¶“å®Œæˆæ‰€æœ‰é¸æ“‡
            // å¦‚æœç”¨æˆ¶å·²ç¶“é¸æ“‡äº†é ç®—ï¼Œé‚£éº¼é¡¯ç¤ºæäº¤æŒ‰éˆ•
            const selectedBudgetButton = document.querySelector('button[data-type="budget"].selected');
            if (selectedBudgetButton) {
                const submitContainer = document.getElementById('submit-container');
                if (submitContainer && window.getComputedStyle(submitContainer).display === 'none') {
                    console.log('æª¢æ¸¬åˆ°é ç®—å·²é¸æ“‡ä½†æŒ‰éˆ•æœªé¡¯ç¤ºï¼Œç¾åœ¨é¡¯ç¤ºæŒ‰éˆ•');
                    submitContainer.style.display = 'block';
                    
                    // ç¢ºä¿æ»¾å‹•åˆ°å¯è¦‹å€åŸŸ
                    try {
                        submitContainer.scrollIntoView({ behavior: 'smooth' });
                    } catch (scrollError) {
                        window.scrollBy(0, 200);
                    }
                }
            }
        }, 2000); // 2ç§’å¾Œæª¢æŸ¥
        
        // å¥åº·éœ€æ±‚è™•ç†å‡½æ•¸
        window.showLifestyleOptions = function(healthNeed) {
            console.log(`é¸æ“‡äº†å¥åº·éœ€æ±‚: ${healthNeed}`);
            
            // è¨­ç½®é¸ä¸­ç‹€æ…‹
            document.querySelectorAll('button[data-type="health-need"]').forEach(btn => btn.classList.remove('selected'));
            const currentButton = document.querySelector(`button[data-type="health-need"][data-value="${healthNeed}"]`);
            if (currentButton) currentButton.classList.add('selected');
            
            // ä¿å­˜é¸æ“‡åˆ° sessionStorage å’Œ localStorageï¼Œå¢åŠ å¯é æ€§
            window.userSelections.healthNeed = healthNeed;
            sessionStorage.setItem('userHealthNeed', healthNeed);
            localStorage.setItem('userHealthNeed', healthNeed);
            
            // æ›´æ–°é¡¯ç¤º
            const selectedNeedSpan = document.querySelector('.selected-health-need');
            if (selectedNeedSpan) selectedNeedSpan.textContent = healthNeed;
            
            document.getElementById('health-need-response').style.display = 'block';
            
            // ç«‹å³é¡¯ç¤ºç”Ÿæ´»å‹æ…‹é¸é …
            const lifestyleOptions = document.getElementById('lifestyle-options');
            lifestyleOptions.style.display = 'block';
            lifestyleOptions.scrollIntoView({ behavior: 'smooth', block: 'center' });
        };
        
        // ç”Ÿæ´»å‹æ…‹é¸æ“‡è™•ç†å‡½æ•¸
        window.showBudgetOptions = function(lifestyle) {
            console.log(`é¸æ“‡äº†ç”Ÿæ´»å‹æ…‹: ${lifestyle}`);
            
            // è¨­ç½®é¸ä¸­ç‹€æ…‹
            document.querySelectorAll('button[data-type="lifestyle"]').forEach(btn => btn.classList.remove('selected'));
            const currentButton = document.querySelector(`button[data-type="lifestyle"][data-value="${lifestyle}"]`);
            if (currentButton) currentButton.classList.add('selected');

            // ä¿å­˜é¸æ“‡åˆ° sessionStorage å’Œ localStorage
            window.userSelections.lifestyle = lifestyle;
            sessionStorage.setItem('userLifestyle', lifestyle);
            localStorage.setItem('userLifestyle', lifestyle);

            // æ›´æ–°é¡¯ç¤º
            const selectedLifestyleSpan = document.querySelector('.selected-lifestyle');
            if (selectedLifestyleSpan) selectedLifestyleSpan.textContent = lifestyle;
            
            document.getElementById('lifestyle-response').style.display = 'block';
            
            // ç«‹å³é¡¯ç¤ºé ç®—é¸é …
            const budgetOptions = document.getElementById('budget-options');
            budgetOptions.style.display = 'block';
            budgetOptions.scrollIntoView({ behavior: 'smooth', block: 'center' });
        };
        
        // é ç®—é¸æ“‡è™•ç†å‡½æ•¸
        window.processBudgetSelection = function(budget) {
            console.log(`è™•ç†é ç®—é¸æ“‡: ${budget}`);
            
            const budgetValue = parseInt(budget, 10) || 0;
            
            // ç›´æ¥æ›´æ–°å…¨å±€å°è±¡
            window.userSelections.budget = budgetValue;
            // åŒæ™‚ä¿å­˜åˆ°sessionStorageä½œç‚ºå‚™ä»½
            sessionStorage.setItem('userBudget', budgetValue);
            
            console.log('æ›´æ–°å¾Œçš„é¸æ“‡:', window.userSelections);
            
            // æ›´æ–°é¡¯ç¤º
            const selectedBudgetSpan = document.querySelector('.selected-budget');
            if (selectedBudgetSpan) {
                // ä¾æ“šé ç®—å€¼é¡¯ç¤ºä¸åŒçš„æ–‡æœ¬
                let budgetText = '';
                switch (budget) {
                    case '500':
                        budgetText = 'ç¶“æ¿Ÿå¯¦æƒ å‹ï¼ˆ500å…ƒä»¥ä¸‹ï¼‰';
                        break;
                    case '1000':
                        budgetText = 'ä¸­ç­‰é ç®—ï¼ˆ500-1000å…ƒï¼‰';
                        break;
                    case '2000':
                        budgetText = 'é«˜å“è³ªå‹ï¼ˆ1000å…ƒä»¥ä¸Šï¼‰';
                        break;
                    case '0':
                    default:
                        budgetText = 'ç„¡é ç®—é™åˆ¶';
                        break;
                }
                selectedBudgetSpan.textContent = budgetText;
            }
            
            // é¡¯ç¤ºé ç®—å›æ‡‰
            const budgetResponse = document.getElementById('budget-response');
            if (budgetResponse) {
                budgetResponse.style.display = 'block';
                budgetResponse.classList.add('fade-in');
            }
            
            // å»¶é²é¡¯ç¤ºæäº¤æŒ‰éˆ• - ä½¿ç”¨å¯é çš„é¡¯ç¤ºæ–¹æ³•
            setTimeout(() => {
                const submitContainer = document.getElementById('submit-container');
                if (submitContainer) {
                    console.log('é¡¯ç¤ºæäº¤æŒ‰éˆ•...');
                    submitContainer.style.display = 'block';
                    
                    // ç¢ºä¿æ»¾å‹•åˆ°å¯è¦‹å€åŸŸ
                    try {
                        submitContainer.scrollIntoView({ behavior: 'smooth' });
                    } catch (scrollError) {
                        // ä½¿ç”¨å‚™ç”¨æ»¾å‹•æ–¹æ³•
                        window.scrollBy(0, 200);
                    }
                    
                    // è¨­ç½®ä¸€å€‹å‚™ç”¨è¨ˆæ™‚å™¨ï¼Œæª¢æŸ¥5ç§’å¾ŒæŒ‰éˆ•ä»ç„¶é¡¯ç¤º
                    setTimeout(() => {
                        if (submitContainer && window.getComputedStyle(submitContainer).display === 'none') {
                            console.log('æª¢æ¸¬åˆ°æŒ‰éˆ•æœªé¡¯ç¤ºï¼Œå¼·åˆ¶é¡¯ç¤º');
                            submitContainer.style.display = 'block';
                        }
                    }, 5000);
                } else {
                    console.error('æ‰¾ä¸åˆ°æäº¤æŒ‰éˆ•å®¹å™¨!');
                }
            }, 800);
        };
        
        // ç›´æ¥ç¶å®šå¥åº·éœ€æ±‚æŒ‰éˆ•
        const healthButtons = document.querySelectorAll('button[data-type="health-need"]');
        console.log(`æ‰¾åˆ° ${healthButtons.length} å€‹å¥åº·éœ€æ±‚æŒ‰éˆ•`);
        
        healthButtons.forEach(button => {
            button.addEventListener('click', function() {
                const value = this.getAttribute('data-value');
                console.log(`é»æ“Šäº†å¥åº·éœ€æ±‚æŒ‰éˆ•: ${value}`);
                
                // ç§»é™¤å…¶ä»–æŒ‰éˆ•çš„é¸ä¸­ç‹€æ…‹
                healthButtons.forEach(btn => btn.classList.remove('selected'));
                
                // æ·»åŠ ç•¶å‰æŒ‰éˆ•çš„é¸ä¸­ç‹€æ…‹
                this.classList.add('selected');
                
                // èª¿ç”¨è‡ªå®šç¾©è™•ç†å‡½æ•¸
                window.showLifestyleOptions(value);
            });
            console.log(`æˆåŠŸç¶å®šå¥åº·éœ€æ±‚æŒ‰éˆ•: ${button.getAttribute('data-value')}`);
        });
        
        // ç¶å®šç”Ÿæ´»å‹æ…‹æŒ‰éˆ•
        const lifestyleButtons = document.querySelectorAll('button[data-type="lifestyle"]');
        console.log(`æ‰¾åˆ° ${lifestyleButtons.length} å€‹ç”Ÿæ´»å‹æ…‹æŒ‰éˆ•`);
        
        lifestyleButtons.forEach(button => {
            button.addEventListener('click', function() {
                const value = this.getAttribute('data-value');
                console.log(`é»æ“Šäº†ç”Ÿæ´»å‹æ…‹æŒ‰éˆ•: ${value}`);
                
                // ç§»é™¤å…¶ä»–æŒ‰éˆ•çš„é¸ä¸­ç‹€æ…‹
                lifestyleButtons.forEach(btn => btn.classList.remove('selected'));
                
                // æ·»åŠ ç•¶å‰æŒ‰éˆ•çš„é¸ä¸­ç‹€æ…‹
                this.classList.add('selected');
                
                // èª¿ç”¨è‡ªå®šç¾©è™•ç†å‡½æ•¸
                window.showBudgetOptions(value);
            });
        });
        
        // ç¶å®šé ç®—æŒ‰éˆ•
        const budgetButtons = document.querySelectorAll('button[data-type="budget"]');
        console.log(`æ‰¾åˆ° ${budgetButtons.length} å€‹é ç®—æŒ‰éˆ•`);
        
        budgetButtons.forEach(button => {
            button.addEventListener('click', function() {
                const value = this.getAttribute('data-value');
                console.log(`é»æ“Šäº†é ç®—æŒ‰éˆ•: ${value}`);
                
                // ç§»é™¤å…¶ä»–æŒ‰éˆ•çš„é¸ä¸­ç‹€æ…‹
                budgetButtons.forEach(btn => btn.classList.remove('selected'));
                
                // æ·»åŠ ç•¶å‰æŒ‰éˆ•çš„é¸ä¸­ç‹€æ…‹
                this.classList.add('selected');
                
                // èª¿ç”¨è‡ªå®šç¾©è™•ç†å‡½æ•¸
                window.processBudgetSelection(value);
            });
        });
        
        // ç¶å®šæäº¤æŒ‰éˆ•
        const submitButton = document.getElementById('submit-selections');
        if (submitButton) {
            console.log('æ‰¾åˆ°æäº¤æŒ‰éˆ•');
            submitButton.addEventListener('click', function(e) {
                e.preventDefault();
                console.log('é»æ“Šäº†æäº¤æŒ‰éˆ•');
                
                // æª¢æŸ¥å¿…è¦é¸æ“‡
                if (!window.userSelections.healthNeed) {
                    alert('è«‹é¸æ“‡æ‚¨çš„å¥åº·éœ€æ±‚');
                    return;
                }
                
                // æå‰é¡¯ç¤ºåŠ è¼‰æç¤º
                const loadingIndicator = document.getElementById('loading-indicator');
                if (loadingIndicator) {
                    loadingIndicator.style.display = 'block';
                }

                console.log('ç•¶å‰ç”¨æˆ¶é¸æ“‡:', JSON.stringify(window.userSelections));
                
                // å‰µå»ºå‚™ç”¨çš„æ¸¬è©¦ç”¢å“æ•¸æ“š
                const testProducts = [
                    {
                        id: "test1",
                        name: "è¤ªé»‘æ¿€ç´ 3mg",
                        brand: "ç¡çœ å°ˆå®¶",
                        description: "ä¿ƒé€²è‡ªç„¶ç¡çœ çš„è¤ªé»‘æ¿€ç´ è£œå……åŠ‘ï¼Œæ”¹å–„å…¥ç¡æ™‚é–“å’Œç¡çœ å“è³ªã€‚",
                        price: 350,
                        rating: 4.6,
                        image_url: "https://via.placeholder.com/150",
                        benefits: ["æ”¹å–„ç¡çœ è³ªé‡", "ç¸®çŸ­å…¥ç¡æ™‚é–“", "èª¿ç¯€ç”Ÿç†æ™‚é˜"],
                        usage: "ç¡å‰30åˆ†é˜æœç”¨1ç²’",
                        caution: "ç™½å¤©é¿å…æœç”¨ï¼Œå¯èƒ½å°è‡´å—œç¡",
                        ingredients: "è¤ªé»‘æ¿€ç´ ã€æ¤ç‰©æ€§è† å›Š",
                        health_needs: ["æ”¹å–„ç¡çœ å“è³ª"],
                        lifestyle_match: [window.userSelections.lifestyle]
                    },
                    {
                        id: "test2",
                        name: "è¤‡åˆé‚è£œå……åŠ‘",
                        brand: "ç‡Ÿé¤Šå‡è¡¡",
                        description: "å«å¤šç¨®å½¢å¼é‚çš„è¤‡åˆé…æ–¹ï¼Œå¹«åŠ©æ”¾é¬†è‚Œè‚‰ï¼Œæ”¹å–„ç¡çœ ï¼Œç·©è§£å£“åŠ›ã€‚",
                        price: 420,
                        rating: 4.5,
                        image_url: "https://via.placeholder.com/150",
                        benefits: ["è‚Œè‚‰æ”¾é¬†", "æ”¹å–„ç¡çœ ", "æ¸›è¼•å£“åŠ›"],
                        usage: "æ¯æ—¥1-2ç²’ï¼Œæ™šé¤æ™‚æœç”¨",
                        caution: "æŸäº›å½¢å¼çš„é‚å¯èƒ½æœ‰è¼•å¾®è…¹ç€‰ä½œç”¨",
                        ingredients: "ç”˜æ°¨é…¸é‚ã€æª¸æª¬é…¸é‚ã€æ°§åŒ–é‚",
                        health_needs: ["æ”¹å–„ç¡çœ å“è³ª", "éª¨éª¼èˆ‡é—œç¯€å¥åº·"],
                        lifestyle_match: [window.userSelections.lifestyle]
                    }
                ];

                try {
                    console.log('æº–å‚™æäº¤é¸æ“‡ï¼Œè·³è½‰åˆ°çµæœé é¢');
                    
                    // å‰µå»ºæ¸¬è©¦ç”¢å“æ•¸æ“šå­—ç¬¦ä¸²
                    const testProductsJson = JSON.stringify(testProducts);
                    
                    // å„²å­˜å®Œæ•´æ•¸æ“šåˆ° sessionStorage
                    sessionStorage.setItem('recommendedProducts', testProductsJson);
                    sessionStorage.setItem('userHealthNeed', window.userSelections.healthNeed);
                    sessionStorage.setItem('userLifestyle', window.userSelections.lifestyle || '');
                    sessionStorage.setItem('userBudget', window.userSelections.budget || 0);
                    
                    console.log('å·²å°‡æ•¸æ“šä¿å­˜åˆ°sessionStorage');
                    console.log('é©—è­‰sessionStorageæ•¸æ“š:');
                    console.log('- userHealthNeed:', sessionStorage.getItem('userHealthNeed'));
                    console.log('- userLifestyle:', sessionStorage.getItem('userLifestyle'));
                    console.log('- userBudget:', sessionStorage.getItem('userBudget'));
                    console.log('- recommendedProductsé•·åº¦:', JSON.parse(sessionStorage.getItem('recommendedProducts')).length);
                    
                    // ä½¿ç”¨è¶…é€£çµå…ƒç´ é€²è¡Œè·³è½‰
                    console.log('ä½¿ç”¨æ–°æ–¹æ³•é€²è¡Œé é¢è·³è½‰');
                    
                    // å‰µå»ºä¸€å€‹è¶…é€£çµä¸¦é»æ“Š
                    const link = document.createElement('a');
                    link.href = 'results.html';
                    link.style.display = 'none';
                    document.body.appendChild(link);
                    
                    console.log('è·³è½‰é€£çµå·²å‰µå»ºï¼Œå³å°‡é»æ“Š');
                    
                    // ç¢ºä¿è¶…é€£çµå·²ç¶“æ·»åŠ åˆ°DOMä¸­
                    setTimeout(function() {
                        console.log('è§¸ç™¼é€£çµé»æ“Š');
                        link.click();
                        
                        // å‚™ç”¨æ–¹æ¡ˆï¼šå¦‚æœé»æ“Šç„¡æ•ˆï¼Œç›´æ¥è¨­ç½®location
                        setTimeout(function() {
                            console.log('æª¢æŸ¥æ˜¯å¦æˆåŠŸè·³è½‰');
                            if (window.location.href.indexOf('results.html') === -1) {
                                console.log('é€£çµé»æ“Šç„¡æ•ˆï¼Œå˜—è©¦ç›´æ¥è¨­ç½®location');
                                window.location.href = 'results.html';
                                
                                // æœ€å¾Œå‚™ç”¨ï¼šå¦‚æœé‚„æ˜¯ä¸è¡Œï¼Œå˜—è©¦é¡¯ç¤ºæ‰‹å‹•æŒ‰éˆ•
                                setTimeout(function() {
                                    if (window.location.href.indexOf('results.html') === -1) {
                                        console.log('æ‰€æœ‰è·³è½‰æ–¹å¼å¤±æ•—ï¼Œé¡¯ç¤ºæ‰‹å‹•æŒ‰éˆ•');
                                        if (loadingIndicator) {
                                            loadingIndicator.style.display = 'none';
                                        }
                                        const manualRedirect = document.getElementById('manual-redirect');
                                        if (manualRedirect) {
                                            manualRedirect.style.display = 'block';
                                            alert('è‡ªå‹•è·³è½‰å¤±æ•—ï¼Œè«‹é»æ“Š"æ‰‹å‹•æŸ¥çœ‹çµæœ"æŒ‰éˆ•');
                                        }
                                    }
                                }, 2000);
                            }
                        }, 1000);
                    }, 100);
                    
                } catch (err) {
                    console.error('æäº¤è™•ç†å‡ºéŒ¯:', err);
                    alert('ç™¼ç”ŸéŒ¯èª¤ï¼Œè«‹é‡è©¦: ' + err.message);
                    
                    if (loadingIndicator) {
                        loadingIndicator.style.display = 'none';
                    }
                    
                    // é¡¯ç¤ºæ‰‹å‹•è·³è½‰æŒ‰éˆ•
                    const manualRedirect = document.getElementById('manual-redirect');
                    if (manualRedirect) {
                        manualRedirect.style.display = 'block';
                    }
                }
            });
        }
        
        // ç¶å®šæ‰‹å‹•è·³è½‰æŒ‰éˆ•
        const manualRedirectBtn = document.getElementById('manual-redirect-btn');
        if (manualRedirectBtn) {
            manualRedirectBtn.addEventListener('click', function() {
                console.log('é»æ“Šäº†æ‰‹å‹•è·³è½‰æŒ‰éˆ•');
                
                // å…ˆç¢ºä¿æ‰€æœ‰æ•¸æ“šéƒ½å„²å­˜åˆ°sessionStorage
                sessionStorage.setItem('userHealthNeed', window.userSelections.healthNeed || 'æ”¹å–„ç¡çœ å“è³ª');
                sessionStorage.setItem('userLifestyle', window.userSelections.lifestyle || 'é•·æ™‚é–“å·¥ä½œ');
                sessionStorage.setItem('userBudget', window.userSelections.budget || 0);
                
                // ç¢ºä¿æœ‰æ¸¬è©¦æ•¸æ“š
                if (!sessionStorage.getItem('recommendedProducts')) {
                    const testProducts = [
                        {
                            id: "manual1",
                            name: "æ‰‹å‹•è·³è½‰-æ¸¬è©¦ç”¢å“",
                            brand: "æ¸¬è©¦å“ç‰Œ",
                            description: "é€™æ˜¯é€šéæ‰‹å‹•è·³è½‰æŒ‰éˆ•å‰µå»ºçš„æ¸¬è©¦ç”¢å“æ•¸æ“šã€‚",
                            price: 350,
                            rating: 4.5,
                            image_url: "https://via.placeholder.com/150",
                            benefits: ["æ¸¬è©¦åŠŸæ•ˆ1", "æ¸¬è©¦åŠŸæ•ˆ2"],
                            usage: "æ¸¬è©¦ç”¨æ³•èªªæ˜",
                            caution: "æ¸¬è©¦æ³¨æ„äº‹é …",
                            ingredients: "æ¸¬è©¦æˆåˆ†",
                            health_needs: ["æ”¹å–„ç¡çœ å“è³ª"],
                            lifestyle_match: ["é•·æ™‚é–“å·¥ä½œ"]
                        }
                    ];
                    sessionStorage.setItem('recommendedProducts', JSON.stringify(testProducts));
                }
                
                // ç›´æ¥ä½¿ç”¨location.replaceé€²è¡Œè·³è½‰ï¼Œé€™æ¨£ä¸æœƒæ·»åŠ åˆ°æ­·å²è¨˜éŒ„ä¸­
                try {
                    console.log('æ‰‹å‹•è·³è½‰ - å˜—è©¦ä½¿ç”¨location.replace');
                    window.location.replace('results.html');
                } catch (err) {
                    console.error('æ‰‹å‹•è·³è½‰ - location.replaceå¤±æ•—:', err);
                    
                    // å¦‚æœreplaceå¤±æ•—ï¼Œå˜—è©¦ä½¿ç”¨href
                    try {
                        console.log('æ‰‹å‹•è·³è½‰ - å˜—è©¦ä½¿ç”¨location.href');
                        window.location.href = 'results.html';
                    } catch (err2) {
                        console.error('æ‰‹å‹•è·³è½‰ - location.hrefä¹Ÿå¤±æ•—:', err2);
                        alert('è·³è½‰å¤±æ•—ï¼Œè«‹å˜—è©¦ç›´æ¥åœ¨ç€è¦½å™¨åœ°å€æ¬„è¼¸å…¥ /results.html');
                    }
                }
            });
        }
    });

    // åœ¨é–‹ç™¼æ¨¡å¼ä¸‹é¡¯ç¤ºèª¿è©¦å·¥å…·
    if (window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1') {
        document.getElementById('debug-tools').style.display = 'block';
        
        // é¡¯ç¤ºsessionStorageæ•¸æ“š
        document.getElementById('debug-show-data').addEventListener('click', function() {
            const output = document.getElementById('debug-output');
            output.style.display = 'block';
            let data = '';
            for (let i = 0; i < sessionStorage.length; i++) {
                const key = sessionStorage.key(i);
                let value = sessionStorage.getItem(key);
                
                // å¦‚æœæ˜¯JSONï¼Œå˜—è©¦æ ¼å¼åŒ–é¡¯ç¤º
                try {
                    const parsedValue = JSON.parse(value);
                    if (typeof parsedValue === 'object') {
                        value = '(Object with ' + Object.keys(parsedValue).length + ' properties)';
                    }
                } catch (e) {
                    // ä¸æ˜¯JSONï¼Œä¿æŒåŸæ¨£
                }
                
                data += `${key}: ${value}\n`;
            }
            
            // é¡¯ç¤ºwindow.userSelections
            data += '\nwindow.userSelections:\n';
            data += JSON.stringify(window.userSelections, null, 2);
            
            output.textContent = data;
        });
        
        // æ¸¬è©¦é é¢è·³è½‰
        document.getElementById('debug-test-redirect').addEventListener('click', function() {
            const output = document.getElementById('debug-output');
            output.style.display = 'block';
            output.textContent = 'å˜—è©¦è·³è½‰åˆ°results.html...\n';
            
            // ä¾æ¬¡å˜—è©¦ä¸åŒçš„è·³è½‰æ–¹å¼
            const methods = [
                '1. location.href',
                '2. location.replace',
                '3. å‰µå»ºé€£çµä¸¦é»æ“Š',
                '4. å‰µå»ºè¡¨å–®ä¸¦æäº¤',
                '5. window.open'
            ];
            
            let currentMethod = 0;
            
            function tryNextMethod() {
                if (currentMethod >= methods.length) {
                    output.textContent += '\næ‰€æœ‰è·³è½‰æ–¹å¼éƒ½å·²å˜—è©¦å®Œç•¢ã€‚è«‹æª¢æŸ¥ç¶²é å’Œæ§åˆ¶å°ã€‚';
                    return;
                }
                
                output.textContent += `\nå˜—è©¦æ–¹æ³•: ${methods[currentMethod]}\n`;
                
                switch (currentMethod) {
                    case 0:
                        try {
                            window.location.href = 'results.html';
                            output.textContent += 'åŸ·è¡Œå®Œç•¢ï¼Œæª¢æŸ¥æ˜¯å¦è·³è½‰æˆåŠŸ...';
                        } catch (e) {
                            output.textContent += `éŒ¯èª¤: ${e.message}`;
                            currentMethod++;
                            setTimeout(tryNextMethod, 1000);
                        }
                        break;
                        
                    case 1:
                        try {
                            window.location.replace('results.html');
                            output.textContent += 'åŸ·è¡Œå®Œç•¢ï¼Œæª¢æŸ¥æ˜¯å¦è·³è½‰æˆåŠŸ...';
                        } catch (e) {
                            output.textContent += `éŒ¯èª¤: ${e.message}`;
                            currentMethod++;
                            setTimeout(tryNextMethod, 1000);
                        }
                        break;
                        
                    case 2:
                        try {
                            const link = document.createElement('a');
                            link.href = 'results.html';
                            link.style.display = 'none';
                            document.body.appendChild(link);
                            link.click();
                            output.textContent += 'åŸ·è¡Œå®Œç•¢ï¼Œæª¢æŸ¥æ˜¯å¦è·³è½‰æˆåŠŸ...';
                        } catch (e) {
                            output.textContent += `éŒ¯èª¤: ${e.message}`;
                            currentMethod++;
                            setTimeout(tryNextMethod, 1000);
                        }
                        break;
                        
                    case 3:
                        try {
                            const form = document.createElement('form');
                            form.action = 'results.html';
                            form.method = 'get';
                            document.body.appendChild(form);
                            form.submit();
                            output.textContent += 'åŸ·è¡Œå®Œç•¢ï¼Œæª¢æŸ¥æ˜¯å¦è·³è½‰æˆåŠŸ...';
                        } catch (e) {
                            output.textContent += `éŒ¯èª¤: ${e.message}`;
                            currentMethod++;
                            setTimeout(tryNextMethod, 1000);
                        }
                        break;
                        
                    case 4:
                        try {
                            window.open('results.html', '_self');
                            output.textContent += 'åŸ·è¡Œå®Œç•¢ï¼Œæª¢æŸ¥æ˜¯å¦è·³è½‰æˆåŠŸ...';
                        } catch (e) {
                            output.textContent += `éŒ¯èª¤: ${e.message}`;
                            output.textContent += '\næ‰€æœ‰æ–¹æ³•éƒ½å˜—è©¦å¤±æ•—ã€‚';
                        }
                        break;
                }
                
                currentMethod++;
            }
            
            tryNextMethod();
        });
        
        // æ¸…é™¤æ‰€æœ‰æ•¸æ“š
        document.getElementById('debug-clear-data').addEventListener('click', function() {
            sessionStorage.clear();
            window.userSelections = {
                healthNeed: '',
                lifestyle: '',
                budget: 0
            };
            
            const output = document.getElementById('debug-output');
            output.style.display = 'block';
            output.textContent = 'æ‰€æœ‰æ•¸æ“šå·²æ¸…é™¤';
        });
    }
    </script>

    <!-- æ·»åŠ å°è©±æ¡†æ¼¸å…¥å‹•ç•«çš„JavaScript -->
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // é¸å–æ‰€æœ‰ chat-message å…ƒç´ 
            const chatMessages = document.querySelectorAll('.chat-message');
            
            // ä½¿ç”¨ setTimeout æ·»åŠ å»¶é²ï¼Œä½¿å‹•ç•«æ•ˆæœæ›´æ˜é¡¯
            chatMessages.forEach((message, index) => {
                setTimeout(() => {
                    message.style.opacity = '1';
                }, 100 * (index + 1)); // æ¯å€‹å°è©±æ¡†ä¾åºé¡¯ç¤º
            });
        });
    </script>
</body>
</html> 
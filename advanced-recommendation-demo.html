<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NutriPal - 高級推薦演示</title>
    <link rel="stylesheet" href="styles.css">
    <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        .demo-section {
            margin-bottom: 30px;
            padding: 20px;
            background-color: white;
            border-radius: 12px;
            box-shadow: var(--shadow-sm);
        }
        .input-group {
            margin-bottom: 15px;
        }
        .tag-container {
            display: flex;
            flex-wrap: wrap;
            gap: 5px;
            margin-top: 10px;
        }
        .tag {
            background-color: var(--secondary);
            padding: 5px 10px;
            border-radius: 20px;
            font-size: 14px;
            display: flex;
            align-items: center;
        }
        .tag .remove {
            margin-left: 5px;
            cursor: pointer;
            color: var(--text-secondary);
        }
        .results-container {
            margin-top: 20px;
        }
    </style>
</head>
<body>
    <!-- iOS 狀態欄 -->
    <div class="status-bar">
        <div class="status-bar-time">9:45</div>
        <div class="status-bar-icons">
            <i class="fas fa-signal"></i>
            <i class="fas fa-wifi"></i>
            <i class="fas fa-battery-full"></i>
        </div>
    </div>

    <!-- 頂部導航 -->
    <div style="display: flex; align-items: center; padding: 12px 16px; border-bottom: 1px solid var(--border-color); background-color: white;">
        <a href="index.html" style="color: var(--text-primary); margin-right: 12px;">
            <i class="fas fa-arrow-left"></i>
        </a>
        <div style="flex: 1; text-align: center; font-weight: 600;">高級推薦功能演示</div>
        <div style="width: 24px;"></div>
    </div>

    <!-- 主要內容區 -->
    <div class="app-content" style="padding: 16px;">
        <div class="card" style="margin-bottom: 24px;">
            <h1 style="font-size: 20px; margin: 0 0 10px;">NutriPal 高級推薦引擎</h1>
            <p>這個演示頁面展示了NutriPal的高級推薦功能，包括複合健康需求篩選、禁忌成分排除、季節性調整等。</p>
        </div>

        <!-- 高級推薦表單 -->
        <div class="demo-section">
            <h2 style="font-size: 18px; margin: 0 0 15px;">設定推薦參數</h2>
            
            <div class="input-group">
                <label for="health-needs">健康需求 (可選擇多個)</label>
                <select id="health-needs" class="form-select">
                    <option value="">選擇健康需求...</option>
                    <option value="改善睡眠品質">改善睡眠品質</option>
                    <option value="增強免疫力">增強免疫力</option>
                    <option value="提升腦力與專注">提升腦力與專注</option>
                    <option value="心臟健康">心臟健康</option>
                    <option value="骨骼與關節健康">骨骼與關節健康</option>
                    <option value="視力保健">視力保健</option>
                    <option value="肝臟保健">肝臟保健</option>
                    <option value="女性保健">女性保健</option>
                    <option value="消化系統保健">消化系統保健</option>
                    <option value="體重管理">體重管理</option>
                </select>
                <button id="add-health-need" class="btn-secondary" style="margin-top: 10px;">添加健康需求</button>
                
                <div id="selected-health-needs" class="tag-container"></div>
            </div>
            
            <div class="input-group">
                <label for="lifestyle">生活型態</label>
                <select id="lifestyle" class="form-select">
                    <option value="">選擇生活型態...</option>
                    <option value="長時間工作">長時間工作</option>
                    <option value="經常運動">經常運動</option>
                    <option value="飲食不規律">飲食不規律</option>
                    <option value="長時間使用電子產品">長時間使用電子產品</option>
                    <option value="經常熬夜">經常熬夜</option>
                    <option value="經常外食">經常外食</option>
                </select>
            </div>
            
            <div class="input-group">
                <label for="budget">預算上限</label>
                <input type="number" id="budget" class="form-control" placeholder="輸入預算上限...">
            </div>
            
            <div class="input-group">
                <label for="forbidden">禁忌成分 (用逗號分隔)</label>
                <input type="text" id="forbidden" class="form-control" placeholder="例如：乳糖,麩質,酵母...">
            </div>
            
            <div class="input-group">
                <label for="season">季節性考慮</label>
                <select id="season" class="form-select">
                    <option value="">無季節性考慮</option>
                    <option value="spring">春季</option>
                    <option value="summer">夏季</option>
                    <option value="autumn">秋季</option>
                    <option value="winter">冬季</option>
                </select>
            </div>
            
            <button id="get-recommendations" class="btn-primary">取得高級推薦</button>
        </div>

        <!-- 結果顯示區域 -->
        <div class="demo-section">
            <h2 style="font-size: 18px; margin: 0 0 15px;">推薦結果</h2>
            <div id="loading-indicator" style="display: none; text-align: center;">
                <div class="loading-spinner"></div>
                <p>正在處理您的請求...</p>
            </div>
            <div id="results-container" class="results-container"></div>
        </div>
    </div>

    <!-- 底部導航欄 -->
    <div class="tab-bar">
        <a href="home.html" class="tab-item">
            <i class="fas fa-home"></i>
            <span>首頁</span>
        </a>
        <a href="chat.html" class="tab-item">
            <i class="fas fa-comment-medical"></i>
            <span>諮詢</span>
        </a>
        <a href="knowledge.html" class="tab-item">
            <i class="fas fa-book-medical"></i>
            <span>知識庫</span>
        </a>
        <a href="#" class="tab-item">
            <i class="fas fa-user"></i>
            <span>我的</span>
        </a>
    </div>

    <!-- 引入腳本 -->
    <script src="js/recommendationEngine.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // 初始化變數
            const selectedHealthNeeds = [];

            // 取得DOM元素
            const healthNeedsSelect = document.getElementById('health-needs');
            const addHealthNeedBtn = document.getElementById('add-health-need');
            const selectedHealthNeedsContainer = document.getElementById('selected-health-needs');
            const lifestyleSelect = document.getElementById('lifestyle');
            const budgetInput = document.getElementById('budget');
            const forbiddenInput = document.getElementById('forbidden');
            const seasonSelect = document.getElementById('season');
            const getRecommendationsBtn = document.getElementById('get-recommendations');
            const loadingIndicator = document.getElementById('loading-indicator');
            const resultsContainer = document.getElementById('results-container');

            // 添加健康需求
            addHealthNeedBtn.addEventListener('click', function() {
                const selectedValue = healthNeedsSelect.value;
                const selectedText = healthNeedsSelect.options[healthNeedsSelect.selectedIndex].text;
                
                if (selectedValue && !selectedHealthNeeds.includes(selectedValue)) {
                    selectedHealthNeeds.push(selectedValue);
                    
                    const tag = document.createElement('div');
                    tag.className = 'tag';
                    tag.innerHTML = `
                        ${selectedText}
                        <span class="remove" data-value="${selectedValue}">&times;</span>
                    `;
                    selectedHealthNeedsContainer.appendChild(tag);
                    
                    // 重置選擇框
                    healthNeedsSelect.value = '';
                }
            });
            
            // 移除健康需求
            selectedHealthNeedsContainer.addEventListener('click', function(e) {
                if (e.target.classList.contains('remove')) {
                    const valueToRemove = e.target.dataset.value;
                    const index = selectedHealthNeeds.indexOf(valueToRemove);
                    
                    if (index !== -1) {
                        selectedHealthNeeds.splice(index, 1);
                        e.target.parentElement.remove();
                    }
                }
            });
            
            // 獲取推薦
            getRecommendationsBtn.addEventListener('click', async function() {
                // 顯示加載中
                loadingIndicator.style.display = 'block';
                resultsContainer.innerHTML = '';
                
                try {
                    // 準備參數
                    const params = {
                        healthNeeds: selectedHealthNeeds.length > 0 ? selectedHealthNeeds : null,
                        lifestyle: lifestyleSelect.value || null,
                        budget: budgetInput.value ? parseInt(budgetInput.value, 10) : 0,
                        forbiddenIngredients: forbiddenInput.value ? 
                            forbiddenInput.value.split(',').map(item => item.trim()) : [],
                        season: seasonSelect.value || null,
                        resultCount: 3
                    };
                    
                    // 使用高級推薦功能
                    if (window.NutriPalRecommender && window.NutriPalRecommender.advancedRecommendProducts) {
                        const recommendations = await window.NutriPalRecommender.advancedRecommendProducts(params);
                        
                        // 顯示結果
                        displayResults(recommendations);
                    } else {
                        resultsContainer.innerHTML = '<p class="error">推薦引擎未載入。請刷新頁面後再試。</p>';
                    }
                } catch (error) {
                    console.error('獲取推薦時出錯:', error);
                    resultsContainer.innerHTML = `<p class="error">獲取推薦時出錯: ${error.message}</p>`;
                } finally {
                    // 隱藏加載中
                    loadingIndicator.style.display = 'none';
                }
            });
            
            // 顯示推薦結果
            function displayResults(products) {
                if (!products || products.length === 0) {
                    resultsContainer.innerHTML = '<p>沒有找到符合條件的產品。請嘗試調整您的篩選條件。</p>';
                    return;
                }
                
                let html = '';
                
                products.forEach(product => {
                    html += `
                    <div class="product-card">
                        <img src="${product.image_url}" alt="${product.name}產品圖片">
                        <div class="product-info">
                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">
                                <div style="flex: 1;">
                                    <p class="product-title">${product.brand} ${product.name}</p>
                                    <p class="product-desc">${product.description.substring(0, 80)}...</p>
                                </div>
                                <div class="price">$${product.price}</div>
                            </div>
                            
                            <div style="display: flex; flex-wrap: wrap; margin-bottom: 12px;">
                                ${product.benefits.map(benefit => `<span class="badge">${benefit}</span>`).join('')}
                            </div>
                            
                            ${product.matchScore !== undefined ? 
                                `<div style="margin-bottom: 8px;">
                                    <span style="font-size: 14px; color: var(--primary);">健康需求匹配度: ${Math.round(product.matchScore * 100)}%</span>
                                </div>` : ''}
                            
                            ${product.seasonalWeight !== undefined ? 
                                `<div style="margin-bottom: 8px;">
                                    <span style="font-size: 14px; color: var(--primary);">季節適用性: ${product.seasonalWeight.toFixed(1)}</span>
                                </div>` : ''}

                            <div style="display: flex; justify-content: space-between; align-items: center;">
                                <div style="display: flex; align-items: center;">
                                    <i class="fas fa-star" style="color: var(--accent); margin-right: 4px;"></i>
                                    <span style="font-size: 14px;">${product.rating}</span>
                                </div>
                                <a href="#" class="btn-primary" style="font-size: 14px; padding: 8px 12px;">
                                    <i class="fas fa-shopping-cart"></i> 查看詳情
                                </a>
                            </div>
                        </div>
                    </div>
                    `;
                });
                
                resultsContainer.innerHTML = html;
            }
        });
    </script>
</body>
</html> 